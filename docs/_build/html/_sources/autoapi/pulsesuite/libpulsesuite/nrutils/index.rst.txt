:py:mod:`pulsesuite.libpulsesuite.nrutils`
==========================================

.. py:module:: pulsesuite.libpulsesuite.nrutils

.. autoapi-nested-parse::

   High-performance numerical utilities for scientific computing, ported from Fortran's nrutils.F90.

   Implements array/matrix utilities, polynomial evaluation, and more, using NumPy and Numba for speed.
   All functions use camelCase. Designed for use in HPC and large-scale data processing.

   Dependencies: constants.py, logger.py, numerictypes.py

   Author: Rahul R. Sah



Module Contents
---------------


Functions
~~~~~~~~~

.. autoapisummary::

   pulsesuite.libpulsesuite.nrutils.with_guardrails
   pulsesuite.libpulsesuite.nrutils.arrayCopy
   pulsesuite.libpulsesuite.nrutils.swap
   pulsesuite.libpulsesuite.nrutils.reallocate
   pulsesuite.libpulsesuite.nrutils.imaxloc
   pulsesuite.libpulsesuite.nrutils.iminloc
   pulsesuite.libpulsesuite.nrutils.assertTrue
   pulsesuite.libpulsesuite.nrutils.assertEq
   pulsesuite.libpulsesuite.nrutils.arth
   pulsesuite.libpulsesuite.nrutils.geop
   pulsesuite.libpulsesuite.nrutils.cumsum
   pulsesuite.libpulsesuite.nrutils.poly
   pulsesuite.libpulsesuite.nrutils.polyTerm
   pulsesuite.libpulsesuite.nrutils.outerprod
   pulsesuite.libpulsesuite.nrutils.outerdiff
   pulsesuite.libpulsesuite.nrutils.scatterAdd
   pulsesuite.libpulsesuite.nrutils.scatterMax
   pulsesuite.libpulsesuite.nrutils.diagAdd
   pulsesuite.libpulsesuite.nrutils.diagMult
   pulsesuite.libpulsesuite.nrutils.getDiag
   pulsesuite.libpulsesuite.nrutils.putDiag
   pulsesuite.libpulsesuite.nrutils.unitMatrix
   pulsesuite.libpulsesuite.nrutils.upperTriangle
   pulsesuite.libpulsesuite.nrutils.lowerTriangle
   pulsesuite.libpulsesuite.nrutils.vabs
   pulsesuite.libpulsesuite.nrutils.dummy_jacobian_dp
   pulsesuite.libpulsesuite.nrutils.dummy_jacobian_dpc



Attributes
~~~~~~~~~~

.. autoapisummary::

   pulsesuite.libpulsesuite.nrutils.sp
   pulsesuite.libpulsesuite.nrutils.dp


.. py:function:: with_guardrails(fn)


.. py:data:: sp

   

.. py:data:: dp

   

.. py:function:: arrayCopy(src: numpy.ndarray, dest: numpy.ndarray) -> tuple[int, int]

   Copy elements from src to dest, up to the minimum size.

   :param src: Source array.
   :type src: np.ndarray
   :param dest: Destination array.
   :type dest: np.ndarray

   :returns: * **nCopied** (*int*) -- Number of elements copied.
             * **nNotCopied** (*int*) -- Number of elements not copied (src.size - nCopied).


.. py:function:: swap(a: Any, b: Any) -> tuple[Any, Any]

   Swap two variables or arrays.

   :param a: Variables or arrays to swap.
   :type a: Any
   :param b: Variables or arrays to swap.
   :type b: Any

   :returns: **b, a** -- Swapped values.
   :rtype: tuple


.. py:function:: reallocate(arr: numpy.ndarray, newShape: Union[int, tuple[int, Ellipsis]]) -> numpy.ndarray

   Reallocate an array to a new shape, copying data up to the new size.

   :param arr: Original array.
   :type arr: np.ndarray
   :param newShape: New shape.
   :type newShape: int or tuple of int

   :returns: Reallocated array with data copied.
   :rtype: np.ndarray


.. py:function:: imaxloc(arr: numpy.ndarray) -> int

   Return the index of the maximum value in the array (1-based, Fortran style).

   :param arr: Input array.
   :type arr: np.ndarray

   :returns: Index of the maximum value (1-based).
   :rtype: int


.. py:function:: iminloc(arr: numpy.ndarray) -> int

   Return the index of the minimum value in the array (1-based, Fortran style).

   :param arr: Input array.
   :type arr: np.ndarray

   :returns: Index of the minimum value (1-based).
   :rtype: int


.. py:function:: assertTrue(test: bool, msg: str = 'Assertion failed', file: Optional[str] = None, line: Optional[int] = None)

   Assert that a condition is true, else log error and exit.
   Uses Logger for error reporting.


.. py:function:: assertEq(*args, msg: str = 'Equality assertion failed') -> int

   Assert that all arguments are equal. Returns the value if true, else logs error and exits.


.. py:function:: arth(first: float, increment: float, n: int) -> numpy.ndarray

   Arithmetic progression of length n.


.. py:function:: geop(first: float, factor: float, n: int) -> numpy.ndarray

   Geometric progression of length n.


.. py:function:: cumsum(arr: numpy.ndarray, seed: Optional[Union[float, int]] = None) -> numpy.ndarray

   Cumulative sum of an array, optionally with a seed value.


.. py:function:: poly(x: Union[float, numpy.ndarray], coeffs: numpy.ndarray) -> Union[float, numpy.ndarray]

   Evaluate a polynomial at x with given coefficients (Horner's method).


.. py:function:: polyTerm(a: numpy.ndarray, b: Union[float, int]) -> numpy.ndarray

   Evaluate a polynomial term recursively (Fortran's poly_term).


.. py:function:: outerprod(a: numpy.ndarray, b: numpy.ndarray) -> numpy.ndarray

   Outer product (parallel).


.. py:function:: outerdiff(a: numpy.ndarray, b: numpy.ndarray) -> numpy.ndarray

   Outer difference (parallel).


.. py:function:: scatterAdd(dest: numpy.ndarray, source: numpy.ndarray, destIndex: numpy.ndarray)

   Scatter-add: add source values to dest at indices destIndex (1-based).


.. py:function:: scatterMax(dest: numpy.ndarray, source: numpy.ndarray, destIndex: numpy.ndarray)

   Scatter-max: set dest[i] = max(dest[i], source[j]) at indices destIndex (1-based).


.. py:function:: diagAdd(mat: numpy.ndarray, diag: Union[float, numpy.ndarray]) -> None

   Add scalar or vector diag to mat's diagonal.


.. py:function:: diagMult(mat: numpy.ndarray, diag: Union[float, numpy.ndarray]) -> None

   Multiply scalar or vector diag onto mat's diagonal.


.. py:function:: getDiag(mat: numpy.ndarray) -> numpy.ndarray

   Extract diagonal into a 1D array (parallel).


.. py:function:: putDiag(diagv: numpy.ndarray, mat: numpy.ndarray)

   Set the diagonal of mat to diagv (paralle).


.. py:function:: unitMatrix(mat: numpy.ndarray)

   Set mat to the identity matrix (in-place) (parallel rows).


.. py:function:: upperTriangle(j: int, k: int, extra: int = 0) -> numpy.ndarray

   Return a boolean mask for the upper triangle of a (j, k) matrix (parallel rows).


.. py:function:: lowerTriangle(j: int, k: int, extra: int = 0) -> numpy.ndarray

   Return a boolean mask for the lower triangle of a (j, k) matrix (parallel reduction).


.. py:function:: vabs(v: numpy.ndarray) -> float

   Return the Euclidean norm of a vector (parallel reduction).


.. py:function:: dummy_jacobian_dp(x: float, y: Annotated[numpy.typing.NDArray[numpy.float64], numpy.float64]) -> Tuple[Annotated[numpy.typing.NDArray[numpy.float64], numpy.float64], Annotated[numpy.typing.NDArray[numpy.float64], numpy.float64]]

   Zero‐Jacobian for real ODEs.


.. py:function:: dummy_jacobian_dpc(x: float, y: Annotated[numpy.typing.NDArray[numpy.complex128], numpy.complex128]) -> Tuple[Annotated[numpy.typing.NDArray[numpy.complex128], numpy.complex128], Annotated[numpy.typing.NDArray[numpy.complex128], numpy.complex128]]

   Zero‐Jacobian for complex ODEs.


