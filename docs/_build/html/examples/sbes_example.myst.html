<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Semiconductor Bloch Equations (SBEs) Solver &mdash; pulsesuite 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css?v=7bc2f056" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css?v=37217874" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css?v=6227e517" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css?v=94669e23" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css?v=21a39f42" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css?v=a18b2449" />
      <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css?v=dbff53e4" />
      <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css?v=d7bf34ee" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/css/sphinx_rtd_theme.css?v=3234e928" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/js/hoverxref.js?v=7ecbeab1"></script>
        <script src="../_static/js/tooltipster.bundle.min.js?v=18bf091b"></script>
        <script src="../_static/js/micromodal.min.js?v=04d6302d"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coulomb Interactions in Quantum Wires" href="coulomb_example.myst.html" />
    <link rel="prev" title="Examples Gallery" href="../gallery.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pulsesuite
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">PulseSuite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../gallery.html">Examples Gallery</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Semiconductor Bloch Equations (SBEs) Solver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#theory">Theory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-three-coupled-equations">The Three Coupled Equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hamiltonian-construction">Hamiltonian Construction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-evolution-scheme">Time Evolution Scheme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#many-body-effects">Many-Body Effects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-and-initialization">Setup and Initialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-existing-parameter-files">Using Existing Parameter Files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-reference">Parameter Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quantum-wire-parameters-qw-params">Quantum Wire Parameters (qw.params)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#many-body-physics-flags-mb-params">Many-Body Physics Flags (mb.params)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-integration-overview">Module Integration Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialize-sbe-module">Initialize SBE Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-carrier-distributions">Initial Carrier Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#material-constants">Material Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-qw-optics-module">Integration with QW Optics Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#field-projection-workflow">Field Projection Workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-coulomb-module">Integration with Coulomb Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#screened-coulomb-interactions">Screened Coulomb Interactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#excitonic-correlations">Excitonic Correlations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-dephasing-module">Integration with Dephasing Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dephasing-rate-calculations">Dephasing Rate Calculations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-phonons-module">Integration with Phonons Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-emission-module">Integration with Emission Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-dc-field-module">Integration with DC Field Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-time-evolution">Basic Time Evolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coherence-matrix-evolution">Coherence Matrix Evolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparation-function">Preparation Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-derivatives">Time Derivatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Many-Body Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-unified-workflow-integration-with-propagation">Complete Unified Workflow: Integration with Propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-time-steps">Multiple Time Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-flags-and-physics-control">Module Flags and Physics Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assumptions-and-parameter-choices">Assumptions and Parameter Choices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#material-parameters-gaas">Material Parameters (GaAs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wire-dimensions">Wire Dimensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grid-parameters">Grid Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simplifications">Simplifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#when-to-use-more-realistic-approaches">When to Use More Realistic Approaches</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-sbes-functions">Core SBEs Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integrated-modules">Integrated Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#key-takeaway">Key Takeaway</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#complete-unified-example">Complete Unified Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coulomb_example.myst.html">Coulomb Interactions in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="dcfield_example.myst.html">DC Field Carrier Transport in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="emission_example.myst.html">Spontaneous Emission and Photoluminescence in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="phonons_example.myst.html">Phonon Interactions in Quantum Wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="qwoptics_example.myst.html">Quantum Wire Optics and Field Conversion</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pulsesuite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../gallery.html">Examples Gallery</a></li>
      <li class="breadcrumb-item active">Semiconductor Bloch Equations (SBEs) Solver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/sbes_example.myst.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="semiconductor-bloch-equations-sbes-solver">
<h1>Semiconductor Bloch Equations (SBEs) Solver<a class="headerlink" href="#semiconductor-bloch-equations-sbes-solver" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>This is the most important documentation file in the entire PSTD3D package.</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">SBEs</span></code> module is the <strong>central unifying component</strong> that integrates all PSTD3D submodules into a cohesive simulation framework. Understanding SBEs is essential for understanding how the entire system works together.</p>
<p><strong>SBEs unifies the following modules:</strong></p>
<ul class="simple">
<li><p><strong>qwoptics</strong>: Field projection between propagation and quantum wire spaces, polarization and charge density calculations</p></li>
<li><p><strong>coulomb</strong>: Screened Coulomb interactions, excitonic correlations, many-body effects</p></li>
<li><p><strong>dephasing</strong>: Momentum-dependent dephasing rates, carrier-carrier and carrier-phonon scattering</p></li>
<li><p><strong>phonons</strong>: Phonon scattering rates, temperature-dependent effects</p></li>
<li><p><strong>emission</strong>: Spontaneous recombination, photoluminescence</p></li>
<li><p><strong>dcfield</strong>: DC transport, drift and diffusion effects</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">InitializeSBE</span></code> function orchestrates initialization of all these subsystems, and <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code> coordinates their operation during time evolution. This documentation shows how all these pieces work together to solve the complete many-body semiconductor problem.</p>
</div>
<section id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Link to this heading">¶</a></h2>
<p>The Semiconductor Bloch Equations (SBEs) are a set of coupled differential equations that describe the time evolution of quantum coherence in semiconductor systems. They extend the optical Bloch equations to include many-body Coulomb interactions, carrier-carrier scattering, and phonon effects.</p>
<section id="the-three-coupled-equations">
<h3>The Three Coupled Equations<a class="headerlink" href="#the-three-coupled-equations" title="Link to this heading">¶</a></h3>
<p>The SBEs consist of three coupled equations for three coherence matrices:</p>
<p><strong>1. Electron-Hole Coherence (Interband Polarization):</strong></p>
<div class="math notranslate nohighlight">
\[
i\hbar \frac{dp_{k_e,k_h}}{dt} = \sum_{k'} H_{k_h,k'}^{hh} p_{k',k_e} + \sum_{k'} H_{k_e,k'}^{ee} p_{k_h,k'} - \sum_{k'} H_{k',k_h}^{eh\dagger} C_{k',k_e} - \sum_{k'} H_{k_e,k'}^{eh} D_{k',k_h} + H_{k_e,k_h}^{eh} - i\hbar(\gamma_e(k_e) + \gamma_h(k_h)) p_{k_e,k_h} + \Gamma_p^{off}(k_e,k_h)
\]</div>
<p>where <span class="math notranslate nohighlight">\(p_{k_e,k_h}\)</span> is the electron-hole coherence matrix representing interband polarization.</p>
<p><strong>2. Electron-Electron Coherence:</strong></p>
<div class="math notranslate nohighlight">
\[
i\hbar \frac{dC_{k_1,k_2}}{dt} = \sum_{k'} H_{k_2,k'}^{ee} C_{k_1,k'} - \sum_{k'} H_{k',k_1}^{ee} C_{k',k_2} + \sum_{k'} H_{k_2,k'}^{eh} p_{k_1,k'}^\dagger - \sum_{k'} H_{k',k_1}^{eh\dagger} p_{k',k_2}
\]</div>
<p>where <span class="math notranslate nohighlight">\(C_{k_1,k_2}\)</span> is the electron-electron coherence matrix. Diagonal elements <span class="math notranslate nohighlight">\(C_{k,k} = n_e(k)\)</span> are electron occupation numbers.</p>
<p><strong>3. Hole-Hole Coherence:</strong></p>
<div class="math notranslate nohighlight">
\[
i\hbar \frac{dD_{k_1,k_2}}{dt} = \sum_{k'} H_{k_2,k'}^{hh} D_{k_1,k'} - \sum_{k'} H_{k',k_1}^{hh} D_{k',k_2} + \sum_{k'} H_{k',k_2}^{eh\dagger} p_{k',k_1}^\dagger - \sum_{k'} H_{k_1,k'}^{eh\dagger} p_{k_2,k'}
\]</div>
<p>where <span class="math notranslate nohighlight">\(D_{k_1,k_2}\)</span> is the hole-hole coherence matrix. Diagonal elements <span class="math notranslate nohighlight">\(D_{k,k} = n_h(k)\)</span> are hole occupation numbers.</p>
</section>
<section id="hamiltonian-construction">
<h3>Hamiltonian Construction<a class="headerlink" href="#hamiltonian-construction" title="Link to this heading">¶</a></h3>
<p>The effective Hamiltonians include:</p>
<p><strong>Electron-Hole Hamiltonian:</strong></p>
<div class="math notranslate nohighlight">
\[
H_{k_e,k_h}^{eh} = M_{k_e,k_h}^{eh} + \sum_q V_{eh}(q) p_{k_e+q,k_h+q}^\dagger
\]</div>
<p>where <span class="math notranslate nohighlight">\(M^{eh}\)</span> is the dipole-field coupling and <span class="math notranslate nohighlight">\(V_{eh}\)</span> is the screened Coulomb interaction.</p>
<p><strong>Electron-Electron Hamiltonian:</strong></p>
<div class="math notranslate nohighlight">
\[
H_{k_1,k_2}^{ee} = E_e(k_1)\delta_{k_1,k_2} - \sum_q V_{ee}(q) C_{k_1+q,k_2+q}^\dagger + \sum_k [V_{ee}(q)C_{k,k+q} - V_{eh}(q)D_{k+q,k}]
\]</div>
<p><strong>Hole-Hole Hamiltonian:</strong></p>
<div class="math notranslate nohighlight">
\[
H_{k_1,k_2}^{hh} = E_h(k_1)\delta_{k_1,k_2} - \sum_q V_{hh}(q) D_{k_1+q,k_2+q}^\dagger + \sum_k [V_{hh}(q)D_{k,k+q} - V_{eh}(q)C_{k+q,k}]
\]</div>
</section>
<section id="time-evolution-scheme">
<h3>Time Evolution Scheme<a class="headerlink" href="#time-evolution-scheme" title="Link to this heading">¶</a></h3>
<p>The SBEs use a leapfrog integration scheme with reshuffling for stability:</p>
<ol class="arabic simple">
<li><p><strong>Leapfrog step:</strong> <span class="math notranslate nohighlight">\(X_3 = X_1 + \frac{dX}{dt} \cdot 2\Delta t\)</span> (2nd order accurate)</p></li>
<li><p><strong>Reshuffling:</strong> <span class="math notranslate nohighlight">\(X_2 = \frac{X_1 + X_3}{2}\)</span> (converts to stable 1st order scheme)</p></li>
</ol>
<p>where <span class="math notranslate nohighlight">\(X\)</span> represents any of the coherence matrices (p, C, D).</p>
</section>
<section id="many-body-effects">
<h3>Many-Body Effects<a class="headerlink" href="#many-body-effects" title="Link to this heading">¶</a></h3>
<p>The SBEs include:</p>
<ul class="simple">
<li><p><strong>Coulomb interactions:</strong> Screened electron-electron, hole-hole, and electron-hole interactions</p></li>
<li><p><strong>Excitonic correlations:</strong> Bound electron-hole pairs (excitons)</p></li>
<li><p><strong>Carrier-carrier scattering:</strong> Many-body collision terms (MBCE, MBCH)</p></li>
<li><p><strong>Phonon scattering:</strong> Carrier-phonon interactions (MBPE, MBPH)</p></li>
<li><p><strong>Dephasing:</strong> Momentum-dependent dephasing rates <span class="math notranslate nohighlight">\(\gamma_e(k)\)</span>, <span class="math notranslate nohighlight">\(\gamma_h(k)\)</span></p></li>
<li><p><strong>DC transport:</strong> Drift and diffusion in applied electric fields</p></li>
</ul>
</section>
</section>
<section id="setup-and-initialization">
<h2>Setup and Initialization<a class="headerlink" href="#setup-and-initialization" title="Link to this heading">¶</a></h2>
<p>The SBEs module requires two parameter files that define the physical system and control which physics are included. These files are located in <code class="docutils literal notranslate"><span class="pre">src/pulsesuite/PSTD3D/params/</span></code> and should be copied to your working directory.</p>
<section id="using-existing-parameter-files">
<h3>Using Existing Parameter Files<a class="headerlink" href="#using-existing-parameter-files" title="Link to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">e</span> <span class="k">as</span> <span class="n">e0</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">epsilon_0</span> <span class="k">as</span> <span class="n">eps0</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D</span><span class="w"> </span><span class="kn">import</span> <span class="n">SBEs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>

<span class="c1"># Create parameter directories if they don&#39;t exist</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;dataQW&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Copy existing parameter files from the package</span>
<span class="c1"># These files contain well-tested default values</span>
<span class="n">package_params_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;PSTD3D&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">)</span>
<span class="n">package_qw_params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_params_dir</span><span class="p">,</span> <span class="s1">&#39;qw.params&#39;</span><span class="p">)</span>
<span class="n">package_mb_params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_params_dir</span><span class="p">,</span> <span class="s1">&#39;mb.params&#39;</span><span class="p">)</span>

<span class="c1"># Copy parameter files to working directory</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">package_qw_params</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">package_qw_params</span><span class="p">,</span> <span class="s1">&#39;params/qw.params&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied qw.params from </span><span class="si">{</span><span class="n">package_qw_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: qw.params not found in package, using defaults&quot;</span><span class="p">)</span>
    <span class="c1"># Create default qw.params</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;params/qw.params&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;100e-9</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    <span class="c1"># L: Wire length (m)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;5e-9</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># Delta0: Wire thickness (m)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1.5</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>       <span class="c1"># gap: Band gap (eV)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.067</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>     <span class="c1"># me: Electron effective mass (m0)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.45</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># mh: Hole effective mass (m0)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>       <span class="c1"># HO: Energy level separation (eV)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1e12</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># gam_e: Electron dephasing (Hz)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1e12</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># gam_h: Hole dephasing (Hz)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1e12</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># gam_eh: Interband dephasing (Hz)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;12.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># epsr: Relative permittivity</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.036</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>     <span class="c1"># Oph: Phonon energy (eV)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.003</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>     <span class="c1"># Gph: Phonon damping (eV)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>        <span class="c1"># Edc: DC field (V/m)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;500</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>       <span class="c1"># jmax: Output interval</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;20000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>     <span class="c1"># ntmax: Backup interval</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">package_mb_params</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">package_mb_params</span><span class="p">,</span> <span class="s1">&#39;params/mb.params&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied mb.params from </span><span class="si">{</span><span class="n">package_mb_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: mb.params not found in package, using defaults&quot;</span><span class="p">)</span>
    <span class="c1"># Create default mb.params</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;params/mb.params&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Optics: Light-matter coupling</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Excitons: Excitonic correlations</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># EHs: Carrier-carrier scattering</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Screened: Screened Coulomb</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Phonon: Phonon scattering</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># DCTrans: DC transport</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># LF: Longitudinal field</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># FreePot: Free potential</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># DiagDph: Diagonal dephasing</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># OffDiagDph: Off-diagonal dephasing</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Recomb: Spontaneous recombination</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># PLSpec: Photoluminescence spectrum</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># ignorewire: Ignore wire effects</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># Xqwparams: Write susceptibility params</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># LorentzDelta: Lorentzian delta function</span>

<span class="c1"># Read and display parameter values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Quantum Wire Parameters (qw.params) ===&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;params/qw.params&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;Delta0&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;me&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;mh&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;HO&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;gam_e&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;gam_h&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;gam_eh&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;epsr&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;Oph&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;Gph&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;Edc&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;jmax&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="s1">&#39;ntmax&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm (Wire length)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Delta0 = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Delta0&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm (Wire thickness)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gap = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gap&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV (Band gap)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;me = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m0 (Electron effective mass)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mh = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mh&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m0 (Hole effective mass)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HO = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;HO&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> meV (Energy level separation)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gam_e = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gam_e&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> THz (Electron dephasing)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gam_h = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gam_h&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> THz (Hole dephasing)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gam_eh = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gam_eh&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> THz (Interband dephasing)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epsr = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;epsr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (Relative permittivity)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Oph = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Oph&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> meV (Phonon energy)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gph = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Gph&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> meV (Phonon damping)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edc = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Edc&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MV/m (DC field)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;jmax = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;jmax&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Output interval)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ntmax = </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;ntmax&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Backup interval)&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Many-Body Physics Flags (mb.params) ===&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;params/mb.params&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Optics&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;Excitons&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;EHs&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;Screened&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;Phonon&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;DCTrans&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;LF&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;FreePot&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;DiagDph&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;OffDiagDph&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;Recomb&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;PLSpec&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;ignorewire&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;Xqwparams&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="s1">&#39;LorentzDelta&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
    <span class="p">}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">flags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ENABLED&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">15s</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Grid parameters for propagation space</span>
<span class="n">N_prop</span> <span class="o">=</span> <span class="mi">256</span>           <span class="c1"># Propagation space grid points</span>
<span class="n">R_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">500e-9</span><span class="p">,</span> <span class="mf">500e-9</span><span class="p">,</span> <span class="n">N_prop</span><span class="p">)</span>  <span class="c1"># 1 μm total window</span>
<span class="n">q_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1e8</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">,</span> <span class="n">N_prop</span><span class="p">)</span>  <span class="c1"># Momentum array for fields</span>

<span class="c1"># Laser parameters</span>
<span class="n">lam</span> <span class="o">=</span> <span class="mf">800e-9</span>           <span class="c1"># Wavelength: 800 nm</span>
<span class="n">Emax0</span> <span class="o">=</span> <span class="mf">1e6</span>            <span class="c1"># Initial peak field: 1 MV/m</span>
<span class="n">r0</span> <span class="o">=</span> <span class="mf">0.0</span>               <span class="c1"># Wire center position</span>
<span class="n">Nw</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c1"># Number of wires</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Propagation domain: </span><span class="si">{</span><span class="n">R_prop</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">R_prop</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Laser wavelength: </span><span class="si">{</span><span class="n">lam</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Copied qw.params from /mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/../PSTD3D/params/qw.params
Copied mb.params from /mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/../PSTD3D/params/mb.params

=== Quantum Wire Parameters (qw.params) ===
L = 100.0 nm (Wire length)
Delta0 = 5.0 nm (Wire thickness)
gap = 1.50 eV (Band gap)
me = 0.070 m0 (Electron effective mass)
mh = 0.450 m0 (Hole effective mass)
HO = 100.0 meV (Energy level separation)
gam_e = 1.0 THz (Electron dephasing)
gam_h = 1.0 THz (Hole dephasing)
gam_eh = 1.0 THz (Interband dephasing)
epsr = 9.1 (Relative permittivity)
Oph = 36.0 meV (Phonon energy)
Gph = 3.0 meV (Phonon damping)
Edc = 0.00 MV/m (DC field)
jmax = 500 (Output interval)
ntmax = 20000 (Backup interval)

=== Many-Body Physics Flags (mb.params) ===
Optics          = ENABLED
Excitons        = ENABLED
EHs             = ENABLED
Screened        = ENABLED
Phonon          = ENABLED
DCTrans         = ENABLED
LF              = ENABLED
FreePot         = disabled
DiagDph         = ENABLED
OffDiagDph      = ENABLED
Recomb          = ENABLED
PLSpec          = disabled
ignorewire      = disabled
Xqwparams       = ENABLED
LorentzDelta    = disabled

Propagation domain: -500.0 to 500.0 nm
Laser wavelength: 800.0 nm
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="parameter-reference">
<h2>Parameter Reference<a class="headerlink" href="#parameter-reference" title="Link to this heading">¶</a></h2>
<section id="quantum-wire-parameters-qw-params">
<h3>Quantum Wire Parameters (qw.params)<a class="headerlink" href="#quantum-wire-parameters-qw-params" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">qw.params</span></code> file contains 15 physical parameters, one per line:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Line</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Units</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Typical Values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>L</p></td>
<td><p>m</p></td>
<td><p>Wire length</p></td>
<td><p>50-500 nm (50e-9 to 500e-9)</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Delta0</p></td>
<td><p>m</p></td>
<td><p>Wire thickness (z-direction)</p></td>
<td><p>3-10 nm (3e-9 to 10e-9)</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>gap</p></td>
<td><p>eV</p></td>
<td><p>Band gap energy</p></td>
<td><p>GaAs: 1.42-1.5, InAs: 0.35</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>me</p></td>
<td><p>m0</p></td>
<td><p>Electron effective mass</p></td>
<td><p>GaAs: 0.067, InAs: 0.023</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>mh</p></td>
<td><p>m0</p></td>
<td><p>Hole effective mass</p></td>
<td><p>GaAs: 0.45 (heavy), 0.08 (light)</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>HO</p></td>
<td><p>eV</p></td>
<td><p>Energy level separation</p></td>
<td><p>0.05-0.2 (confinement energy)</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>gam_e</p></td>
<td><p>Hz</p></td>
<td><p>Electron dephasing rate</p></td>
<td><p>0.1-10 THz (1e11 to 1e13)</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>gam_h</p></td>
<td><p>Hz</p></td>
<td><p>Hole dephasing rate</p></td>
<td><p>0.1-10 THz (1e11 to 1e13)</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>gam_eh</p></td>
<td><p>Hz</p></td>
<td><p>Interband dephasing rate</p></td>
<td><p>Usually (gam_e + gam_h)/2</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>epsr</p></td>
<td><p>-</p></td>
<td><p>Relative permittivity</p></td>
<td><p>GaAs: 12.0-13.0</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>Oph</p></td>
<td><p>eV</p></td>
<td><p>Phonon energy</p></td>
<td><p>GaAs LO: 0.036, InAs: 0.030</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>Gph</p></td>
<td><p>eV</p></td>
<td><p>Phonon damping rate</p></td>
<td><p>0.001-0.005 (1-5 meV)</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>Edc</p></td>
<td><p>V/m</p></td>
<td><p>DC electric field</p></td>
<td><p>0-1e6 (transport studies)</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>jmax</p></td>
<td><p>-</p></td>
<td><p>Output interval</p></td>
<td><p>10-1000 (write frequency)</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p>ntmax</p></td>
<td><p>-</p></td>
<td><p>Backup interval</p></td>
<td><p>1000-50000 (backup frequency)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="many-body-physics-flags-mb-params">
<h3>Many-Body Physics Flags (mb.params)<a class="headerlink" href="#many-body-physics-flags-mb-params" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">mb.params</span></code> file contains 15 boolean flags (1=enabled, 0=disabled):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Line</p></th>
<th class="head"><p>Flag</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>When to Enable</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Optics</p></td>
<td><p>Light-matter coupling</p></td>
<td><p>Always (required for optical response)</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Excitons</p></td>
<td><p>Excitonic correlations</p></td>
<td><p>For exciton physics, bound states</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>EHs</p></td>
<td><p>Carrier-carrier scattering</p></td>
<td><p>For many-body collisions, thermalization</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Screened</p></td>
<td><p>Screened Coulomb</p></td>
<td><p>For realistic screening (usually with Excitons)</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Phonon</p></td>
<td><p>Phonon scattering</p></td>
<td><p>For temperature effects, energy relaxation</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>DCTrans</p></td>
<td><p>DC transport</p></td>
<td><p>For drift/diffusion, transport studies</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>LF</p></td>
<td><p>Longitudinal field</p></td>
<td><p>For plasmon effects, screening dynamics</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>FreePot</p></td>
<td><p>Free potential</p></td>
<td><p>For carrier-induced potential</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>DiagDph</p></td>
<td><p>Diagonal dephasing</p></td>
<td><p>Usually enabled (momentum-dependent rates)</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>OffDiagDph</p></td>
<td><p>Off-diagonal dephasing</p></td>
<td><p>For correlation effects in scattering</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>Recomb</p></td>
<td><p>Spontaneous recombination</p></td>
<td><p>For radiative decay, PL studies</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>PLSpec</p></td>
<td><p>Photoluminescence spectrum</p></td>
<td><p>For PL calculations</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>ignorewire</p></td>
<td><p>Ignore wire effects</p></td>
<td><p>Single-wire approximation</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>Xqwparams</p></td>
<td><p>Write susceptibility params</p></td>
<td><p>For χ(q,ω) parameter files</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p>LorentzDelta</p></td>
<td><p>Lorentzian delta function</p></td>
<td><p>For numerical integration method</p></td>
</tr>
</tbody>
</table>
<p><strong>Common Physics Combinations:</strong></p>
<ul class="simple">
<li><p><strong>Basic optics</strong>: <code class="docutils literal notranslate"><span class="pre">Optics=1</span></code>, all others <code class="docutils literal notranslate"><span class="pre">0</span></code> (OBE limit)</p></li>
<li><p><strong>Excitons only</strong>: <code class="docutils literal notranslate"><span class="pre">Optics=1,</span> <span class="pre">Excitons=1,</span> <span class="pre">Screened=1,</span> <span class="pre">DiagDph=1</span></code></p></li>
<li><p><strong>Full many-body</strong>: <code class="docutils literal notranslate"><span class="pre">Optics=1,</span> <span class="pre">Excitons=1,</span> <span class="pre">EHs=1,</span> <span class="pre">Screened=1,</span> <span class="pre">DiagDph=1</span></code></p></li>
<li><p><strong>Temperature effects</strong>: Add <code class="docutils literal notranslate"><span class="pre">Phonon=1</span></code> to above</p></li>
<li><p><strong>Transport</strong>: Add <code class="docutils literal notranslate"><span class="pre">DCTrans=1,</span> <span class="pre">LF=1</span></code> for drift and plasmon effects</p></li>
</ul>
</section>
</section>
<section id="module-integration-overview">
<h2>Module Integration Overview<a class="headerlink" href="#module-integration-overview" title="Link to this heading">¶</a></h2>
<p>The SBEs module acts as the central orchestrator that integrates all PSTD3D submodules. The following diagram shows how all modules connect:</p>
<p><strong>Initialization Flow:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InitializeSBE</span></code> reads parameter files (<code class="docutils literal notranslate"><span class="pre">qw.params</span></code>, <code class="docutils literal notranslate"><span class="pre">mb.params</span></code>)</p></li>
<li><p>Calculates material constants and grids</p></li>
<li><p>Conditionally initializes subsystems based on flags:</p>
<ul class="simple">
<li><p>Always: <code class="docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeCoulomb</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeDephasing</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Phonon=1</span></code>: <code class="docutils literal notranslate"><span class="pre">InitializePhonons</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">DCTrans=1</span></code>: <code class="docutils literal notranslate"><span class="pre">InitializeDC</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Recomb=1</span></code>: <code class="docutils literal notranslate"><span class="pre">InitializeEmission</span></code></p></li>
</ul>
</li>
</ol>
<p><strong>Time Evolution Flow (QWCalculator):</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Prop2QW</span></code>: Convert propagation fields → QW momentum space (uses qwoptics)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SBECalculator</span></code>: Solve SBEs using all initialized modules</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QWPolarization3</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">QWRho5</span></code>: Calculate outputs (uses qwoptics)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QW2Prop</span></code>: Convert QW fields → propagation space (uses qwoptics)</p></li>
</ol>
</section>
<section id="initialize-sbe-module">
<h2>Initialize SBE Module<a class="headerlink" href="#initialize-sbe-module" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">InitializeSBE</span></code> function sets up all arrays, calculates material constants, and <strong>orchestrates initialization of all integrated modules</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the SBE module</span>
<span class="c1"># This function internally calls:</span>
<span class="c1">#   - InitializeQWOptics: Sets up optical coupling matrices (always called)</span>
<span class="c1">#   - InitializeCoulomb: Calculates screened Coulomb interactions (always called)</span>
<span class="c1">#   - InitializeDephasing: Sets up dephasing rate calculations (always called)</span>
<span class="c1">#   - InitializePhonons: Sets up phonon scattering (if Phonon flag is enabled)</span>
<span class="c1">#   - InitializeDC: Prepares DC field transport (if DCTrans flag is enabled)</span>
<span class="c1">#   - InitializeEmission: Sets up spontaneous emission (if Recomb flag is enabled)</span>
<span class="n">SBEs</span><span class="o">.</span><span class="n">InitializeSBE</span><span class="p">(</span>
    <span class="n">q</span><span class="o">=</span><span class="n">q_prop</span><span class="p">,</span>          <span class="c1"># Momentum array for fields</span>
    <span class="n">rr</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span>         <span class="c1"># Spatial position array for propagation space</span>
    <span class="n">r0</span><span class="o">=</span><span class="n">r0</span><span class="p">,</span>             <span class="c1"># Reference position offset</span>
    <span class="n">Emaxxx</span><span class="o">=</span><span class="n">Emax0</span><span class="p">,</span>      <span class="c1"># Initial peak electric field</span>
    <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span>           <span class="c1"># Laser wavelength</span>
    <span class="n">Nw</span><span class="o">=</span><span class="n">Nw</span><span class="p">,</span>             <span class="c1"># Number of quantum wires</span>
    <span class="n">QW</span><span class="o">=</span><span class="kc">True</span>            <span class="c1"># Enable quantum wire calculations</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SBE module initialized&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of k-points: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of r-points: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Momentum spacing: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_dkr</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spatial spacing: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_dr</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Subsystems initialized:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - QW Optics: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_Xcv0&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Coulomb: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_VC&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Dephasing: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_GamE&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Phonon&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Phonons: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_MBPE&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DCTrans&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - DC Field: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_Edrift&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Recomb&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Emission: </span><span class="si">{</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_Rsp&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dcv / e0 = 3.3538811268940077e-10
alphae = 303090660.34386384, alphah = 768475083.4742767
1/qc = 2.3003106022655407e-09, sqrt(2) / sqrt(alphae² + alphah²) = 1.7119449377756965e-09
ehint = 0.8262109841666643
Wire Radius = 2.3003106022655407e-09
Wire sqrt(area) = 3.8950888292173374e-09
Wire Thickness = 5e-09
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calculating Coulomb Arrays
  Progress: 0/230 (0.0%)
Vint: Using JIT-compiled version
  Progress: 10/230 (4.3%)
  Progress: 20/230 (8.7%)
  Progress: 30/230 (13.0%)
  Progress: 40/230 (17.4%)
  Progress: 50/230 (21.7%)
  Progress: 60/230 (26.1%)
  Progress: 70/230 (30.4%)
  Progress: 80/230 (34.8%)
  Progress: 90/230 (39.1%)
  Progress: 100/230 (43.5%)
  Progress: 110/230 (47.8%)
  Progress: 120/230 (52.2%)
  Progress: 130/230 (56.5%)
  Progress: 140/230 (60.9%)
  Progress: 150/230 (65.2%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Progress: 160/230 (69.6%)
  Progress: 170/230 (73.9%)
  Progress: 180/230 (78.3%)
  Progress: 190/230 (82.6%)
  Progress: 200/230 (87.0%)
  Progress: 210/230 (91.3%)
  Progress: 220/230 (95.7%)
Finished Calculating Unscreened Coulomb Arrays
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantum Wire Linear Chi = (-0.13219666733079763+0.14243061062572296j)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>InitializeSBE?
SBE module initialized
Number of k-points: 114
Number of r-points: 230
Momentum spacing: 3.14e+07 m^-1
Spatial spacing: 8.70e-10 m

Subsystems initialized:
  - QW Optics: False
  - Coulomb: False
  - Dephasing: False
  - Phonons: False
  - DC Field: False
  - Emission: False
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-carrier-distributions">
<h2>Initial Carrier Distributions<a class="headerlink" href="#initial-carrier-distributions" title="Link to this heading">¶</a></h2>
<p>After initialization, the coherence matrices are set to initial values. Let’s examine them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access initial coherence matrices (stored as module-level variables)</span>
<span class="c1"># These are 3D arrays: (Nk, Nk, Nw) for each time step</span>
<span class="c1"># _YY1, _YY2, _YY3: electron-hole coherence at t(n-1), t(n), t(n+1)</span>
<span class="c1"># _CC1, _CC2, _CC3: electron-electron coherence</span>
<span class="c1"># _DD1, _DD2, _DD3: hole-hole coherence</span>

<span class="c1"># Extract initial populations from diagonal elements</span>
<span class="n">ne_initial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_CC1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>
<span class="n">nh_initial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_DD1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>

<span class="c1"># Get momentum and energy arrays</span>
<span class="n">kr</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span>
<span class="n">Ee</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Ee</span>
<span class="n">Eh</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Eh</span>
<span class="n">gap</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_gap</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial electron population range: </span><span class="si">{</span><span class="n">ne_initial</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">ne_initial</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial hole population range: </span><span class="si">{</span><span class="n">nh_initial</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">nh_initial</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total electrons: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ne_initial</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total holes: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nh_initial</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize initial carrier distributions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Electron distribution</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">ne_initial</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electrons&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="p">(</span><span class="n">Ee</span> <span class="o">+</span> <span class="n">gap</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electron energy (meV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Occupation / Energy (meV)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial Electron Distribution&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Hole distribution</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">nh_initial</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Holes&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">Eh</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hole energy (meV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Occupation / Energy (meV)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial Hole Distribution&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial electron population range: 0.0000 to 0.0000
Initial hole population range: 0.0000 to 0.0000
Total electrons: 0.0000
Total holes: 0.0000
</pre></div>
</div>
<img alt="../_images/2871b70f044468048243c94004c4163dd1cb85c037c3c2329522c65f917fade3.png" src="../_images/2871b70f044468048243c94004c4163dd1cb85c037c3c2329522c65f917fade3.png" />
</div>
</div>
</section>
<section id="material-constants">
<h2>Material Constants<a class="headerlink" href="#material-constants" title="Link to this heading">¶</a></h2>
<p>The initialization calculates important material constants:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access material constants (stored as module-level variables)</span>
<span class="n">dcv</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_dcv</span>
<span class="n">alphae</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_alphae</span>
<span class="n">alphah</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_alphah</span>
<span class="n">ehint</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_ehint</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_qc</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_area</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Material Constants:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dipole moment: </span><span class="si">{</span><span class="n">dcv</span><span class="o">/</span><span class="n">e0</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C·m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron confinement: </span><span class="si">{</span><span class="n">alphae</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hole confinement: </span><span class="si">{</span><span class="n">alphah</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlap integral: </span><span class="si">{</span><span class="n">ehint</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical momentum: </span><span class="si">{</span><span class="n">qc</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wire area: </span><span class="si">{</span><span class="n">area</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m²&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wire radius (1/qc): </span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">qc</span><span class="o">*</span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Material Constants:
Dipole moment: 3.35e-10 C·m
Electron confinement: 3.03e+08 m^-1
Hole confinement: 7.68e+08 m^-1
Overlap integral: 0.8262
Critical momentum: 4.35e+08 m^-1
Wire area: 1.52e-17 m²
Wire radius (1/qc): 2.30 nm
</pre></div>
</div>
</div>
</div>
</section>
<section id="integration-with-qw-optics-module">
<h2>Integration with QW Optics Module<a class="headerlink" href="#integration-with-qw-optics-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates closely with the <code class="docutils literal notranslate"><span class="pre">qwoptics</span></code> module for field projection and polarization/charge density calculations. This integration happens automatically through <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code>.</p>
<section id="field-projection-workflow">
<h3>Field Projection Workflow<a class="headerlink" href="#field-projection-workflow" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code> function uses qwoptics functions internally:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Demonstrate the field projection workflow used internally by QWCalculator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.qwoptics</span><span class="w"> </span><span class="kn">import</span> <span class="n">Prop2QW</span><span class="p">,</span> <span class="n">QW2Prop</span><span class="p">,</span> <span class="n">QWPolarization3</span><span class="p">,</span> <span class="n">QWRho5</span>

<span class="c1"># Create propagation space fields</span>
<span class="n">Exx_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">R_prop</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">50e-9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e6</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>
<span class="n">Eyy_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx_prop</span><span class="p">)</span>
<span class="n">Ezz_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx_prop</span><span class="p">)</span>
<span class="n">Vrr_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx_prop</span><span class="p">)</span>

<span class="c1"># QW space arrays (will be modified in-place)</span>
<span class="n">Ex_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ey_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ez_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Vr_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Step 1: Project propagation fields to QW space (Prop2QW)</span>
<span class="c1"># This is what QWCalculator does internally</span>
<span class="n">Prop2QW</span><span class="p">(</span>
    <span class="n">rr</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">Exx</span><span class="o">=</span><span class="n">Exx_prop</span><span class="p">,</span> <span class="n">Eyy</span><span class="o">=</span><span class="n">Eyy_prop</span><span class="p">,</span> <span class="n">Ezz</span><span class="o">=</span><span class="n">Ezz_prop</span><span class="p">,</span> <span class="n">Vrr</span><span class="o">=</span><span class="n">Vrr_prop</span><span class="p">,</span>
    <span class="n">Edc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">Ex</span><span class="o">=</span><span class="n">Ex_qw</span><span class="p">,</span> <span class="n">Ey</span><span class="o">=</span><span class="n">Ey_qw</span><span class="p">,</span> <span class="n">Ez</span><span class="o">=</span><span class="n">Ez_qw</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr_qw</span><span class="p">,</span>
    <span class="n">t</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">xxx</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_xxx</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field projection complete (Prop2QW)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Propagation field max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Exx_prop</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> V/m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QW field max (momentum space): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ex_qw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> V/m&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Calculate polarization from coherence (QWPolarization3)</span>
<span class="c1"># This is what SBECalculator does internally</span>
<span class="n">Px_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Py_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pz_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="n">p_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_YY2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Current electron-hole coherence</span>
<span class="n">QWPolarization3</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_current</span><span class="p">,</span>
    <span class="n">ehint</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_ehint</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_area</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_L</span><span class="p">,</span>
    <span class="n">Px</span><span class="o">=</span><span class="n">Px_qw</span><span class="p">,</span> <span class="n">Py</span><span class="o">=</span><span class="n">Py_qw</span><span class="p">,</span> <span class="n">Pz</span><span class="o">=</span><span class="n">Pz_qw</span><span class="p">,</span> <span class="n">xxx</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_xxx</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization calculated (QWPolarization3): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px_qw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Calculate charge densities (QWRho5)</span>
<span class="n">Re_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Rh_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="n">C_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_CC2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Electron-electron coherence</span>
<span class="n">D_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DD2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Hole-hole coherence</span>
<span class="n">ne_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C_current</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
<span class="n">nh_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">D_current</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

<span class="n">QWRho5</span><span class="p">(</span>
    <span class="n">Qr</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Qr</span><span class="p">,</span> <span class="n">kr</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_L</span><span class="p">,</span>
    <span class="n">kkp</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kkp</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_current</span><span class="p">,</span> <span class="n">CC</span><span class="o">=</span><span class="n">C_current</span><span class="p">,</span> <span class="n">DD</span><span class="o">=</span><span class="n">D_current</span><span class="p">,</span>
    <span class="n">ne</span><span class="o">=</span><span class="n">ne_current</span><span class="p">,</span> <span class="n">nh</span><span class="o">=</span><span class="n">nh_current</span><span class="p">,</span>
    <span class="n">re</span><span class="o">=</span><span class="n">Re_qw</span><span class="p">,</span> <span class="n">rh</span><span class="o">=</span><span class="n">Rh_qw</span><span class="p">,</span> <span class="n">xxx</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_xxx</span><span class="p">,</span> <span class="n">jjj</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_jjj</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Charge densities calculated (QWRho5)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron density: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Re_qw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hole density: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Rh_qw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>

<span class="c1"># Step 4: Project back to propagation space (QW2Prop)</span>
<span class="c1"># This is what QWCalculator does internally</span>
<span class="n">Pxx_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pyy_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pzz_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">RhoE_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">RhoH_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="n">QW2Prop</span><span class="p">(</span>
    <span class="n">r</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">Qr</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Qr</span><span class="p">,</span>
    <span class="n">Ex</span><span class="o">=</span><span class="n">Ex_qw</span><span class="p">,</span> <span class="n">Ey</span><span class="o">=</span><span class="n">Ey_qw</span><span class="p">,</span> <span class="n">Ez</span><span class="o">=</span><span class="n">Ez_qw</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr_qw</span><span class="p">,</span>
    <span class="n">Px</span><span class="o">=</span><span class="n">Px_qw</span><span class="p">,</span> <span class="n">Py</span><span class="o">=</span><span class="n">Py_qw</span><span class="p">,</span> <span class="n">Pz</span><span class="o">=</span><span class="n">Pz_qw</span><span class="p">,</span>
    <span class="n">re</span><span class="o">=</span><span class="n">Re_qw</span><span class="p">,</span> <span class="n">rh</span><span class="o">=</span><span class="n">Rh_qw</span><span class="p">,</span>
    <span class="n">RR</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span>
    <span class="n">Pxx</span><span class="o">=</span><span class="n">Pxx_prop</span><span class="p">,</span> <span class="n">Pyy</span><span class="o">=</span><span class="n">Pyy_prop</span><span class="p">,</span> <span class="n">Pzz</span><span class="o">=</span><span class="n">Pzz_prop</span><span class="p">,</span>
    <span class="n">RhoE</span><span class="o">=</span><span class="n">RhoE_prop</span><span class="p">,</span> <span class="n">RhoH</span><span class="o">=</span><span class="n">RhoH_prop</span><span class="p">,</span>
    <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xxx</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_xxx</span><span class="p">,</span> <span class="n">WriteFields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Plasmonics</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Projection back to propagation space complete (QW2Prop)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization in propagation space: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Pxx_prop</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">18</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">Vr_qw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="c1"># Step 1: Project propagation fields to QW space (Prop2QW)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># This is what QWCalculator does internally</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="n">Prop2QW</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">rr</span><span class="o">=</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">Exx</span><span class="o">=</span><span class="n">Exx_prop</span><span class="p">,</span> <span class="n">Eyy</span><span class="o">=</span><span class="n">Eyy_prop</span><span class="p">,</span> <span class="n">Ezz</span><span class="o">=</span><span class="n">Ezz_prop</span><span class="p">,</span> <span class="n">Vrr</span><span class="o">=</span><span class="n">Vrr_prop</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">Edc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span><span class="p">,</span> <span class="n">Ex</span><span class="o">=</span><span class="n">Ex_qw</span><span class="p">,</span> <span class="n">Ey</span><span class="o">=</span><span class="n">Ey_qw</span><span class="p">,</span> <span class="n">Ez</span><span class="o">=</span><span class="n">Ez_qw</span><span class="p">,</span> <span class="n">Vr</span><span class="o">=</span><span class="n">Vr_qw</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">t</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">xxx</span><span class="o">=</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_xxx</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Field projection complete (Prop2QW)&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Propagation field max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Exx_prop</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> V/m&quot;</span><span class="p">)</span>

<span class="ne">TypeError</span>: Prop2QW() got an unexpected keyword argument &#39;rr&#39;
</pre></div>
</div>
</div>
</div>
<p>This complete workflow is exactly what <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code> performs internally for each time step, seamlessly integrating the qwoptics module with the SBE solver.</p>
</section>
</section>
<section id="integration-with-coulomb-module">
<h2>Integration with Coulomb Module<a class="headerlink" href="#integration-with-coulomb-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates with the <code class="docutils literal notranslate"><span class="pre">coulomb</span></code> module to include screened Coulomb interactions and excitonic correlations. This is essential for realistic many-body physics.</p>
<section id="screened-coulomb-interactions">
<h3>Screened Coulomb Interactions<a class="headerlink" href="#screened-coulomb-interactions" title="Link to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The Coulomb module provides screened interaction arrays</span>
<span class="c1"># These are calculated during InitializeSBE via InitializeCoulomb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.coulomb</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalcScreenedArrays</span>

<span class="c1"># Access the screened Coulomb arrays (calculated during initialization)</span>
<span class="c1"># Check if SBEs is initialized</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span> <span class="s1">&#39;_VC&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_VC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;SBEs module not initialized or Coulomb not calculated. Run InitializeSBE first.&quot;</span><span class="p">)</span>

<span class="c1"># VC is a 3D array: VC[Nr, Nr, 3] where the last dimension is:</span>
<span class="c1">#   0: electron-hole interaction (Veh)</span>
<span class="c1">#   1: electron-electron interaction (Vee)</span>
<span class="c1">#   2: hole-hole interaction (Vhh)</span>
<span class="n">VC</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_VC</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Screened Coulomb arrays available&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VC shape: </span><span class="si">{</span><span class="n">VC</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VC represents interactions in real space (r, r&#39;)&quot;</span><span class="p">)</span>

<span class="c1"># Extract 1D interactions for visualization</span>
<span class="c1"># The Coulomb module calculates these from the 3D arrays</span>
<span class="n">Veh_1D</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Electron-hole interaction at r=0</span>
<span class="n">Vee_1D</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Electron-electron interaction at r=0</span>
<span class="n">Vhh_1D</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Hole-hole interaction at r=0</span>

<span class="c1"># Visualize Coulomb interactions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Real space interaction</span>
<span class="n">r_coul</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_r</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_coul</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">Veh_1D</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{eh}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_coul</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">Vee_1D</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{ee}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_coul</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">Vhh_1D</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{hh}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coulomb Interaction (meV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Screened Coulomb Interactions in Real Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Momentum space (Fourier transform)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.usefulsubs</span><span class="w"> </span><span class="kn">import</span> <span class="n">FFTG</span>
<span class="n">Veh_k</span> <span class="o">=</span> <span class="n">Veh_1D</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">FFTG</span><span class="p">(</span><span class="n">Veh_k</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Veh_k</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{eh}</span><span class="s1">(k)$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|V(k)| (meV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Coulomb Interaction in Momentum Space&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Access the screened Coulomb arrays (calculated during initialization)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># Check if SBEs is initialized</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span> <span class="s1">&#39;_VC&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_VC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;SBEs module not initialized or Coulomb not calculated. Run InitializeSBE first.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># VC is a 3D array: VC[Nr, Nr, 3] where the last dimension is:</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1">#   0: electron-hole interaction (Veh)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1">#   1: electron-electron interaction (Vee)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1">#   2: hole-hole interaction (Vhh)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">VC</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_VC</span>

<span class="ne">RuntimeError</span>: SBEs module not initialized or Coulomb not calculated. Run InitializeSBE first.
</pre></div>
</div>
</div>
</div>
</section>
<section id="excitonic-correlations">
<h3>Excitonic Correlations<a class="headerlink" href="#excitonic-correlations" title="Link to this heading">¶</a></h3>
<p>When the <code class="docutils literal notranslate"><span class="pre">Excitons</span></code> flag is enabled, the Coulomb interactions create excitonic correlations that modify the Hamiltonian:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Excitonic effects are included in the Hamiltonian construction</span>
<span class="c1"># via the CalcH function, which uses the screened Coulomb arrays</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Excitonic correlations:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Excitons flag: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Excitons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Screened flag: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Screened</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - These affect the electron-hole Hamiltonian H^</span><span class="si">{</span><span class="n">eh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Bound electron-hole pairs (excitons) modify optical response&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Excitonic correlations:
  - Excitons flag: True
  - Screened flag: True
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Excitons flag: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Excitons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Screened flag: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Screened</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - These affect the electron-hole Hamiltonian H^</span><span class="si">{</span><span class="n">eh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Bound electron-hole pairs (excitons) modify optical response&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;eh&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="integration-with-dephasing-module">
<h2>Integration with Dephasing Module<a class="headerlink" href="#integration-with-dephasing-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates with the <code class="docutils literal notranslate"><span class="pre">dephasing</span></code> module to calculate momentum-dependent dephasing rates.</p>
<section id="dephasing-rate-calculations">
<h3>Dephasing Rate Calculations<a class="headerlink" href="#dephasing-rate-calculations" title="Link to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The dephasing module provides momentum-dependent rates</span>
<span class="c1"># These are calculated during InitializeSBE via InitializeDephasing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.dephasing</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalcGammaE</span><span class="p">,</span> <span class="n">CalcGammaH</span><span class="p">,</span> <span class="n">OffDiagDephasing2</span>

<span class="c1"># Access dephasing rates (calculated during initialization)</span>
<span class="n">GamE</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_GamE</span>  <span class="c1"># Electron dephasing rates γ_e(k)</span>
<span class="n">GamH</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_GamH</span>  <span class="c1"># Hole dephasing rates γ_h(k)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dephasing rates available&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GamE shape: </span><span class="si">{</span><span class="n">GamE</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GamH shape: </span><span class="si">{</span><span class="n">GamH</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron dephasing range: </span><span class="si">{</span><span class="n">GamE</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">GamE</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> THz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hole dephasing range: </span><span class="si">{</span><span class="n">GamH</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">GamH</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> THz&quot;</span><span class="p">)</span>

<span class="c1"># Visualize dephasing rates</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">GamE</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electron γ_e(k)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">GamH</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hole γ_h(k)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dephasing Rate (THz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Momentum-Dependent Dephasing Rates&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Show energy dependence</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Ee</span> <span class="o">+</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_gap</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">GamE</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electron&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Eh</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">GamH</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hole&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy (meV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dephasing Rate (THz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Energy-Dependent Dephasing Rates&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Off-diagonal dephasing (if enabled)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_OffDiagDph</span><span class="p">:</span>
    <span class="n">OffG</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_OffG</span>  <span class="c1"># Off-diagonal dephasing matrix</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Off-diagonal dephasing enabled&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OffG shape: </span><span class="si">{</span><span class="n">OffG</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OffG represents correlation effects in scattering&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.dephasing</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalcGammaE</span><span class="p">,</span> <span class="n">CalcGammaH</span><span class="p">,</span> <span class="n">OffDiagDephasing2</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Access dephasing rates (calculated during initialization)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">GamE</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_GamE</span>  <span class="c1"># Electron dephasing rates γ_e(k)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">GamH</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_GamH</span>  <span class="c1"># Hole dephasing rates γ_h(k)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dephasing rates available&quot;</span><span class="p">)</span>

<span class="ne">AttributeError</span>: module &#39;pulsesuite.PSTD3D.SBEs&#39; has no attribute &#39;_GamE&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="integration-with-phonons-module">
<h2>Integration with Phonons Module<a class="headerlink" href="#integration-with-phonons-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates with the <code class="docutils literal notranslate"><span class="pre">phonons</span></code> module when the <code class="docutils literal notranslate"><span class="pre">Phonon</span></code> flag is enabled, providing temperature-dependent carrier-phonon scattering.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Phonon scattering is conditionally initialized</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Phonon</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.phonons</span><span class="w"> </span><span class="kn">import</span> <span class="n">MBPH</span><span class="p">,</span> <span class="n">MBPE</span><span class="p">,</span> <span class="n">FermiDistr</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Phonon module integrated&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Phonon energy: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Oph</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> meV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Phonon damping: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Gph</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> meV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - MBPH: Hole-phonon scattering available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - MBPE: Electron-phonon scattering available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - FermiDistr: Thermal distribution function available&quot;</span><span class="p">)</span>

    <span class="c1"># Phonon scattering rates are calculated during time evolution</span>
    <span class="c1"># via MBPH and MBPE functions in the Preparation step</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Phonon module not enabled (Phonon flag = 0)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Set Phonon=1 in mb.params to enable&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Enables temperature-dependent effects&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Includes carrier-phonon scattering&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Phonon module integrated
  - Phonon energy: 341370776248822359387996770053128192.0 meV
  - Phonon damping: 28447564687401863282333064171094016.0 meV
  - MBPH: Hole-phonon scattering available
  - MBPE: Electron-phonon scattering available
  - FermiDistr: Thermal distribution function available
</pre></div>
</div>
</div>
</div>
</section>
<section id="integration-with-emission-module">
<h2>Integration with Emission Module<a class="headerlink" href="#integration-with-emission-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates with the <code class="docutils literal notranslate"><span class="pre">emission</span></code> module when the <code class="docutils literal notranslate"><span class="pre">Recomb</span></code> flag is enabled, providing spontaneous recombination.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Spontaneous emission is conditionally initialized</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Recomb</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.emission</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpontEmission</span><span class="p">,</span> <span class="n">Calchw</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Emission module integrated&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Spontaneous recombination enabled&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - SpontEmission: Radiative decay available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Calchw: Emission rate calculation available&quot;</span><span class="p">)</span>

    <span class="c1"># Access emission rates (if calculated)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span> <span class="s1">&#39;_Rsp&#39;</span><span class="p">):</span>
        <span class="n">Rsp</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Rsp</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Recombination rates shape: </span><span class="si">{</span><span class="n">Rsp</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Emission module not enabled (Recomb flag = 0)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Set Recomb=1 in mb.params to enable&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Enables radiative recombination&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Required for photoluminescence studies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Emission module integrated
  - Spontaneous recombination enabled
  - SpontEmission: Radiative decay available
  - Calchw: Emission rate calculation available
</pre></div>
</div>
</div>
</div>
</section>
<section id="integration-with-dc-field-module">
<h2>Integration with DC Field Module<a class="headerlink" href="#integration-with-dc-field-module" title="Link to this heading">¶</a></h2>
<p>The SBEs module integrates with the <code class="docutils literal notranslate"><span class="pre">dcfield</span></code> module when the <code class="docutils literal notranslate"><span class="pre">DCTrans</span></code> flag is enabled, providing carrier transport effects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DC transport is conditionally initialized</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DCTrans</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pulsesuite.PSTD3D.dcfield</span><span class="w"> </span><span class="kn">import</span> <span class="n">GetEDrift</span><span class="p">,</span> <span class="n">Transport</span><span class="p">,</span> <span class="n">CalcI0</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DC Field module integrated&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - DC field: </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Edc</span><span class="o">/</span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - GetEDrift: Drift field calculation available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Transport: Carrier transport calculation available&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - CalcI0: Current calculation available&quot;</span><span class="p">)</span>

    <span class="c1"># DC field effects are included in the Hamiltonian</span>
    <span class="c1"># via the FreePot flag and Wee/Whh monopole coupling</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DC Field module not enabled (DCTrans flag = 0)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Set DCTrans=1 in mb.params to enable&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Enables drift and diffusion effects&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Required for transport studies&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DC Field module integrated
  - DC field: 0.00 MV/m
  - GetEDrift: Drift field calculation available
  - Transport: Carrier transport calculation available
  - CalcI0: Current calculation available
</pre></div>
</div>
</div>
</div>
</section>
<section id="basic-time-evolution">
<h2>Basic Time Evolution<a class="headerlink" href="#basic-time-evolution" title="Link to this heading">¶</a></h2>
<p>Let’s perform a single time step using <code class="docutils literal notranslate"><span class="pre">SBECalculator</span></code>. First, we need to set up the input fields:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-15</span>  <span class="c1"># 1 fs</span>

<span class="c1"># Create electric fields in QW momentum space</span>
<span class="c1"># These would normally come from Prop2QW, but for demonstration we create simple fields</span>
<span class="n">Nr</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nr</span>
<span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Create a simple Gaussian field in momentum space</span>
<span class="c1"># In real usage, fields come from propagation via Prop2QW</span>
<span class="n">k_center</span> <span class="o">=</span> <span class="n">Nr</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">sigma_k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nr</span><span class="p">):</span>
    <span class="n">Ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">k_center</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma_k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e6</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># 1 MV/m peak</span>

<span class="c1"># Output arrays (will be modified in-place)</span>
<span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Perform one time step</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Wire index</span>
<span class="n">WriteFields</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Write output files</span>

<span class="n">SBEs</span><span class="o">.</span><span class="n">SBECalculator</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Rh</span><span class="p">,</span> <span class="n">WriteFields</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time step complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization magnitude: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Electron density: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hole density: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Rh</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 114 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 114 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 114 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba/core/typed_passes.py:336: NumbaPerformanceWarning: 
The keyword argument &#39;parallel=True&#39; was specified but no transformation for parallel execution was possible.

To find out why, try turning on parallel diagnostics, see https://numba.readthedocs.io/en/stable/user/parallel.html#diagnostics for help.

File &quot;../../../src/pulsesuite/PSTD3D/coulomb.py&quot;, line 1784:
@jit(nopython=True, parallel=True)
def _MBCE_core(ne, nh, Veh2, Vee2, Win, Wout, k3, Ceh, Cee):
^

  warnings.warn(errors.NumbaPerformanceWarning(msg,
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba/core/typed_passes.py:336: NumbaPerformanceWarning: 
The keyword argument &#39;parallel=True&#39; was specified but no transformation for parallel execution was possible.

To find out why, try turning on parallel diagnostics, see https://numba.readthedocs.io/en/stable/user/parallel.html#diagnostics for help.

File &quot;../../../src/pulsesuite/PSTD3D/coulomb.py&quot;, line 1914:
@jit(nopython=True, parallel=True)
def _MBCH_core(ne, nh, Veh2, Vhh2, Win, Wout, k3, Ceh, Chh):
^

  warnings.warn(errors.NumbaPerformanceWarning(msg,
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">30</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Wire index</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">WriteFields</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Write output files</span>
<span class="ne">---&gt; </span><span class="mi">30</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">SBECalculator</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Rh</span><span class="p">,</span> <span class="n">WriteFields</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time step complete&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization magnitude: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>

<span class="nn">File /mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/SBEs.py:3911,</span> in <span class="ni">SBECalculator</span><span class="nt">(Ex, Ey, Ez, Vr, dt, Px, Py, Pz, Re, Rh, WriteFields, w)</span>
<span class="g g-Whitespace">   </span><span class="mi">3909</span> <span class="c1"># Write dephasing rates if requested</span>
<span class="g g-Whitespace">   </span><span class="mi">3910</span> <span class="k">if</span> <span class="n">WriteFields</span> <span class="ow">and</span> <span class="n">_DiagDph</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">3911</span>     <span class="n">WriteDephasing</span><span class="p">(</span><span class="n">_kr</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">_xxx</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3913</span> <span class="c1"># Calculate the X, Y, Z components of the QW Polarization</span>
<span class="g g-Whitespace">   </span><span class="mi">3914</span> <span class="k">if</span> <span class="n">_Optics</span><span class="p">:</span>

<span class="nn">File /mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/dephasing.py:987,</span> in <span class="ni">WriteDephasing</span><span class="nt">(ky, gamE, gamH, w, xxx)</span>
<span class="g g-Whitespace">    </span><span class="mi">957</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">958</span><span class="sd"> Write dephasing rates to files.</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">983</span><span class="sd"> - &#39;dataQW/Wire/Gh/Gh.{w:02d}.k.{xxx:05d}.dat&#39; for holes</span>
<span class="g g-Whitespace">    </span><span class="mi">984</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">985</span> <span class="n">wire</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">w</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">987</span> <span class="n">printGam</span><span class="p">(</span><span class="n">gamE</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">xxx</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Wire/Ge/Ge.</span><span class="si">{</span><span class="n">wire</span><span class="si">}</span><span class="s1">.k.&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">988</span> <span class="n">printGam</span><span class="p">(</span><span class="n">gamH</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">xxx</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Wire/Gh/Gh.</span><span class="si">{</span><span class="n">wire</span><span class="si">}</span><span class="s1">.k.&#39;</span><span class="p">)</span>

<span class="nn">File /mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/dephasing.py:951,</span> in <span class="ni">printGam</span><span class="nt">(Dx, z, n, file)</span>
<span class="g g-Whitespace">    </span><span class="mi">925</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span><span class="sd"> Print dephasing rate to file with index number.</span>
<span class="g g-Whitespace">    </span><span class="mi">927</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">948</span><span class="sd"> Each line contains: z(i), Dx(i)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">950</span> <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dataQW/</span><span class="si">{</span><span class="n">file</span><span class="si">}{</span><span class="n">n</span><span class="si">:</span><span class="s1">05d</span><span class="si">}</span><span class="s1">.dat&#39;</span>
<span class="ne">--&gt; </span><span class="mi">951</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">Dx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;dataQW/Wire/Ge/Ge.01.k.00001.dat&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="coherence-matrix-evolution">
<h2>Coherence Matrix Evolution<a class="headerlink" href="#coherence-matrix-evolution" title="Link to this heading">¶</a></h2>
<p>Let’s examine how the coherence matrices evolve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract coherence matrices after one time step</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_YY2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Electron-hole coherence at t(n)</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_CC2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Electron-electron coherence at t(n)</span>
<span class="n">D2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DD2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Hole-hole coherence at t(n)</span>

<span class="c1"># Extract populations from diagonal</span>
<span class="n">ne_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
<span class="n">nh_after</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">D2</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

<span class="c1"># Visualize coherence matrices</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Electron-hole coherence (real part)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron-Hole Coherence (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[p]&#39;</span><span class="p">)</span>

<span class="c1"># Electron-electron coherence (real part)</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">C2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron-Electron Coherence (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[C]&#39;</span><span class="p">)</span>

<span class="c1"># Hole-hole coherence (real part)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">D2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hole-Hole Coherence (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[D]&#39;</span><span class="p">)</span>

<span class="c1"># Population evolution</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">ne_initial</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">ne_after</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;After 1 step&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Electron Occupation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron Population Evolution&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">nh_initial</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">nh_after</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;After 1 step&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Hole Occupation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hole Population Evolution&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Off-diagonal coherence (imaginary part of p)</span>
<span class="n">im4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                       <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron-Hole Coherence (Imaginary)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Im[p]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6600f5e33815984b2b16917525e139bfbc3f1d8bd9c17a87541a8fdb4018189b.png" src="../_images/6600f5e33815984b2b16917525e139bfbc3f1d8bd9c17a87541a8fdb4018189b.png" />
</div>
</div>
</section>
<section id="preparation-function">
<h2>Preparation Function<a class="headerlink" href="#preparation-function" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Preparation</span></code> function calculates all arrays needed for a time step:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allocate arrays for Preparation output</span>
<span class="n">Heh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Hee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Hhh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">VC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">E1D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">GamE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">GamH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">OffG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Rsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Call Preparation</span>
<span class="n">Preparation</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Heh</span><span class="p">,</span> <span class="n">Hee</span><span class="p">,</span> <span class="n">Hhh</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">E1D</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">OffG</span><span class="p">,</span> <span class="n">Rsp</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preparation complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hamiltonian matrices shape: </span><span class="si">{</span><span class="n">Heh</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Screened Coulomb arrays shape: </span><span class="si">{</span><span class="n">VC</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dephasing rates shape: </span><span class="si">{</span><span class="n">GamE</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize Hamiltonians</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Electron-hole Hamiltonian</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Heh</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron-Hole Hamiltonian (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[H$^</span><span class="si">{eh}</span><span class="s1">$] (J)&#39;</span><span class="p">)</span>

<span class="c1"># Electron-electron Hamiltonian</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hee</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electron-Electron Hamiltonian (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[H$^</span><span class="si">{ee}</span><span class="s1">$] (J)&#39;</span><span class="p">)</span>

<span class="c1"># Hole-hole Hamiltonian</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Hhh</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hole-Hole Hamiltonian (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[H$^</span><span class="si">{hh}</span><span class="s1">$] (J)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Visualize dephasing rates</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">GamE</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electron dephasing&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">GamH</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hole dephasing&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dephasing Rate (THz)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Momentum-Dependent Dephasing Rates&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">Rsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># Call Preparation</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">Preparation</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Heh</span><span class="p">,</span> <span class="n">Hee</span><span class="p">,</span> <span class="n">Hhh</span><span class="p">,</span> <span class="n">VC</span><span class="p">,</span> <span class="n">E1D</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">OffG</span><span class="p">,</span> <span class="n">Rsp</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preparation complete&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hamiltonian matrices shape: </span><span class="si">{</span><span class="n">Heh</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;Preparation&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-derivatives">
<h2>Time Derivatives<a class="headerlink" href="#time-derivatives" title="Link to this heading">¶</a></h2>
<p>The time derivatives <code class="docutils literal notranslate"><span class="pre">dpdt</span></code>, <code class="docutils literal notranslate"><span class="pre">dCdt</span></code>, and <code class="docutils literal notranslate"><span class="pre">dDdt</span></code> calculate the rate of change of coherence matrices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate time derivatives</span>
<span class="n">dpdt2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">dpdt</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Heh</span><span class="p">,</span> <span class="n">Hee</span><span class="p">,</span> <span class="n">Hhh</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">OffG</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">dCdt2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">dCdt</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Heh</span><span class="p">,</span> <span class="n">Hee</span><span class="p">,</span> <span class="n">Hhh</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">OffG</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">dDdt2</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">dDdt</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Heh</span><span class="p">,</span> <span class="n">Hee</span><span class="p">,</span> <span class="n">Hhh</span><span class="p">,</span> <span class="n">GamE</span><span class="p">,</span> <span class="n">GamH</span><span class="p">,</span> <span class="n">OffG</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time derivatives calculated&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dp/dt magnitude range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dpdt2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dpdt2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dC/dt magnitude range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dCdt2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dCdt2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s^-1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dD/dt magnitude range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dDdt2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dDdt2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s^-1&quot;</span><span class="p">)</span>

<span class="c1"># Visualize time derivatives</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># dp/dt</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dpdt2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_h$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_e$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;dp/dt (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[dp/dt] (s$^{-1}$)&#39;</span><span class="p">)</span>

<span class="c1"># dC/dt</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dCdt2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;dC/dt (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[dC/dt] (s$^{-1}$)&#39;</span><span class="p">)</span>

<span class="c1"># dD/dt</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dDdt2</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;dD/dt (Real)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Re[dD/dt] (s$^{-1}$)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time derivatives calculated
dp/dt magnitude range: 0.00e+00 to 0.00e+00 s^-1
dC/dt magnitude range: 0.00e+00 to 0.00e+00 s^-1
dD/dt magnitude range: 0.00e+00 to 0.00e+00 s^-1
</pre></div>
</div>
<img alt="../_images/a5d0520275604ded355a790118adb28c0fde42473329ab2b28898d98eff574db.png" src="../_images/a5d0520275604ded355a790118adb28c0fde42473329ab2b28898d98eff574db.png" />
</div>
</div>
</section>
<section id="id1">
<h2>Many-Body Effects<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>The SBEs include various many-body effects controlled by module flags. Let’s examine the screened Coulomb interactions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract screened Coulomb arrays</span>
<span class="n">Veh</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Electron-hole interaction</span>
<span class="n">Vee</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Electron-electron interaction</span>
<span class="n">Vhh</span> <span class="o">=</span> <span class="n">VC</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Hole-hole interaction</span>

<span class="c1"># Visualize Coulomb interactions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Electron-hole interaction</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Veh</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Screened Electron-Hole Interaction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{eh}</span><span class="s1">$ (J)&#39;</span><span class="p">)</span>

<span class="c1"># Electron-electron interaction</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Vee</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Screened Electron-Electron Interaction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{ee}</span><span class="s1">$ (J)&#39;</span><span class="p">)</span>

<span class="c1"># Hole-hole interaction</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Vhh</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                     <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">kr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e8</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k_2$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$k_1$ ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Screened Hole-Hole Interaction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{hh}</span><span class="s1">$ (J)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Show diagonal elements (self-interaction)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Veh</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{eh}</span><span class="s1">(k,k)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Vee</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{ee}</span><span class="s1">(k,k)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Vhh</span><span class="p">)</span><span class="o">/</span><span class="n">e0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$V_</span><span class="si">{hh}</span><span class="s1">(k,k)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coulomb Interaction (meV)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diagonal Coulomb Interactions (Self-Interaction)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c3cc10fbacf8d377f58677c205a72233f9c1e1c12d2bd3b79d32b5517467698f.png" src="../_images/c3cc10fbacf8d377f58677c205a72233f9c1e1c12d2bd3b79d32b5517467698f.png" />
<img alt="../_images/cfd4a33164ea440ff0b02dd3f9ff9de843ba735a25e0f9d6cd4c672146a47ce5.png" src="../_images/cfd4a33164ea440ff0b02dd3f9ff9de843ba735a25e0f9d6cd4c672146a47ce5.png" />
</div>
</div>
</section>
<section id="complete-unified-workflow-integration-with-propagation">
<h2>Complete Unified Workflow: Integration with Propagation<a class="headerlink" href="#complete-unified-workflow-integration-with-propagation" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code> function is the main entry point that <strong>unifies all modules</strong> for integration with Maxwell field propagation. It orchestrates the complete workflow:</p>
<ol class="arabic simple">
<li><p><strong>Field Projection</strong> (qwoptics): <code class="docutils literal notranslate"><span class="pre">Prop2QW</span></code> converts propagation fields to QW space</p></li>
<li><p><strong>SBE Solution</strong> (SBEs + all modules): <code class="docutils literal notranslate"><span class="pre">SBECalculator</span></code> solves SBEs using:</p>
<ul class="simple">
<li><p>Coulomb interactions (coulomb module)</p></li>
<li><p>Dephasing rates (dephasing module)</p></li>
<li><p>Phonon scattering (phonons module, if enabled)</p></li>
<li><p>DC transport (dcfield module, if enabled)</p></li>
<li><p>Spontaneous emission (emission module, if enabled)</p></li>
</ul>
</li>
<li><p><strong>Output Calculation</strong> (qwoptics): <code class="docutils literal notranslate"><span class="pre">QWPolarization3</span></code> and <code class="docutils literal notranslate"><span class="pre">QWRho5</span></code> calculate outputs</p></li>
<li><p><strong>Field Projection</strong> (qwoptics): <code class="docutils literal notranslate"><span class="pre">QW2Prop</span></code> converts QW fields back to propagation space</p></li>
</ol>
<p>This complete workflow demonstrates how SBEs unifies all modules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create propagation space fields</span>
<span class="n">Exx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Eyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Ezz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Vrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Create a Gaussian pulse in propagation space</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">100e-9</span>
<span class="n">center</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Exx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">R_prop</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e6</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>

<span class="c1"># Output arrays for propagation space</span>
<span class="n">Pxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Flags for propagator</span>
<span class="n">DoQWP</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>  <span class="c1"># Will be set by QWCalculator</span>
<span class="n">DoQWDl</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>  <span class="c1"># Will be set by QWCalculator</span>

<span class="c1"># Call QWCalculator (main integration function)</span>
<span class="n">QWCalculator</span><span class="p">(</span><span class="n">Exx</span><span class="p">,</span> <span class="n">Eyy</span><span class="p">,</span> <span class="n">Ezz</span><span class="p">,</span> <span class="n">Vrr</span><span class="p">,</span> <span class="n">R_prop</span><span class="p">,</span> <span class="n">q_prop</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Pxx</span><span class="p">,</span> <span class="n">Pyy</span><span class="p">,</span> <span class="n">Pzz</span><span class="p">,</span> <span class="n">Rho</span><span class="p">,</span> <span class="n">DoQWP</span><span class="p">,</span> <span class="n">DoQWDl</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;QWCalculator complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polarization in propagation space: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Pxx</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Charge density: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Rho</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Use polarization: </span><span class="si">{</span><span class="n">DoQWP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Use longitudinal field: </span><span class="si">{</span><span class="n">DoQWDl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize outputs</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Input field</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Exx</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|E| (V/m)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input Electric Field (Propagation Space)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wire boundaries&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Output polarization</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output Polarization (Propagation Space)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Charge density</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Rho</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Free Charge Density (Propagation Space)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Energy transfer (if available)</span>
<span class="c1"># Note: This is stored in module-level variable _EPEnergy</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">SBEs</span><span class="p">,</span> <span class="s1">&#39;_EPEnergy&#39;</span><span class="p">):</span>
    <span class="n">energy_transfer</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_EPEnergy</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Energy Transfer:</span><span class="se">\n</span><span class="si">{</span><span class="n">energy_transfer</span><span class="o">/</span><span class="n">e0</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Energy Transfer to Quantum Wire&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">23</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="n">DoQWDl</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>  <span class="c1"># Will be set by QWCalculator</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="c1"># Call QWCalculator (main integration function)</span>
<span class="ne">---&gt; </span><span class="mi">23</span> <span class="n">QWCalculator</span><span class="p">(</span><span class="n">Exx</span><span class="p">,</span> <span class="n">Eyy</span><span class="p">,</span> <span class="n">Ezz</span><span class="p">,</span> <span class="n">Vrr</span><span class="p">,</span> <span class="n">R_prop</span><span class="p">,</span> <span class="n">q_prop</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Pxx</span><span class="p">,</span> <span class="n">Pyy</span><span class="p">,</span> <span class="n">Pzz</span><span class="p">,</span> <span class="n">Rho</span><span class="p">,</span> <span class="n">DoQWP</span><span class="p">,</span> <span class="n">DoQWDl</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;QWCalculator complete&quot;</span><span class="p">)</span>
<span class="nn">     26 print(f&quot;Polarization</span> in <span class="ni">propagation space: {np.abs(Pxx).max</span><span class="nt">():.2e} C/m²&quot;)</span>

<span class="ne">NameError</span>: name &#39;QWCalculator&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-time-steps">
<h2>Multiple Time Steps<a class="headerlink" href="#multiple-time-steps" title="Link to this heading">¶</a></h2>
<p>Let’s evolve the system over several time steps to see the dynamics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset to initial state (for demonstration)</span>
<span class="c1"># In real simulations, you&#39;d continue from previous state</span>

<span class="c1"># Perform multiple time steps</span>
<span class="n">N_steps</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">time_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ne_history</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nh_history</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">p_max_history</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_steps</span><span class="p">):</span>
    <span class="c1"># Create fields (simplified - in real usage these come from propagation)</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Simple oscillating field</span>
    <span class="n">Ex</span><span class="p">[</span><span class="n">k_center</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">step</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># Output arrays</span>
    <span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">Rh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Time step</span>
    <span class="n">SBEs</span><span class="o">.</span><span class="n">SBECalculator</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">Rh</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="c1"># Extract populations</span>
    <span class="n">C_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_CC2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">D_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DD2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">p_current</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_YY2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C_current</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">nh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">D_current</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>

    <span class="n">time_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">ne_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ne</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">nh_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nh</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">p_max_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p_current</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evolved system for </span><span class="si">{</span><span class="n">N_steps</span><span class="si">}</span><span class="s2"> time steps&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total time: </span><span class="si">{</span><span class="n">N_steps</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e15</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> fs&quot;</span><span class="p">)</span>

<span class="c1"># Visualize time evolution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Total carrier populations vs time</span>
<span class="n">ne_tot</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span> <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="n">ne_history</span><span class="p">]</span>
<span class="n">nh_tot</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span> <span class="k">for</span> <span class="n">nh</span> <span class="ow">in</span> <span class="n">nh_history</span><span class="p">]</span>
<span class="n">time_fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1e15</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time_points</span><span class="p">]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_fs</span><span class="p">,</span> <span class="n">ne_tot</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total electrons&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_fs</span><span class="p">,</span> <span class="n">nh_tot</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total holes&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (fs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total Population&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Carrier Populations vs Time&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Maximum coherence vs time</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_fs</span><span class="p">,</span> <span class="n">p_max_history</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (fs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Max |p|&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Maximum Electron-Hole Coherence vs Time&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Population at k=0 vs time</span>
<span class="n">k0_idx</span> <span class="o">=</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Nk</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">ne_k0</span> <span class="o">=</span> <span class="p">[</span><span class="n">ne</span><span class="p">[</span><span class="n">k0_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="n">ne_history</span><span class="p">]</span>
<span class="n">nh_k0</span> <span class="o">=</span> <span class="p">[</span><span class="n">nh</span><span class="p">[</span><span class="n">k0_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">nh</span> <span class="ow">in</span> <span class="n">nh_history</span><span class="p">]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_fs</span><span class="p">,</span> <span class="n">ne_k0</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$n_e(k=0)$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_fs</span><span class="p">,</span> <span class="n">nh_k0</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$n_h(k=0)$&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (fs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Occupation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Population at k=0 vs Time&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Final population distribution</span>
<span class="n">ne_final</span> <span class="o">=</span> <span class="n">ne_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nh_final</span> <span class="o">=</span> <span class="n">nh_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">ne_final</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electrons (final)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">nh_final</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Holes (final)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">ne_initial</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Electrons (initial)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kr</span><span class="o">/</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">nh_initial</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Holes (initial)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavevector ($10^8$ m$^{-1}$)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Occupation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Population Distribution: Initial vs Final&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 1 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 1 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/mnt/hardisk/pulsesuite/src/pulsesuite/PSTD3D/SBEs.py:3936: ComplexWarning: Casting complex values to real discards the imaginary part
  _I0[w-1] = CalcI0(ne2, nh2, _Ee, _Eh, VC, _dkr, _kr, _I0[w-1])
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/astavak/.pyenv/versions/3.10.16/envs/venv3.10/lib/python3.10/site-packages/numba_cuda/numba/cuda/dispatcher.py:690: NumbaPerformanceWarning: Grid size 1 will likely result in GPU under-utilization due to low occupancy.
  warn(errors.NumbaPerformanceWarning(msg))
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evolved system for 10 time steps
Total time: 10.00 fs
</pre></div>
</div>
<img alt="../_images/c5d526f752887f895a65d066ab6673ee43a39400bed0961de2fea9ab643b55c9.png" src="../_images/c5d526f752887f895a65d066ab6673ee43a39400bed0961de2fea9ab643b55c9.png" />
</div>
</div>
</section>
<section id="module-flags-and-physics-control">
<h2>Module Flags and Physics Control<a class="headerlink" href="#module-flags-and-physics-control" title="Link to this heading">¶</a></h2>
<p>The SBEs module uses boolean flags to control which physical effects are included:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Physics Flags:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optics (light-matter coupling): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Optics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excitons (excitonic correlations): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Excitons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EHs (carrier-carrier scattering): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_EHs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Screened (screened Coulomb): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Screened</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phonon (phonon scattering): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Phonon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DCTrans (DC transport): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_DCTrans</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LF (longitudinal field): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_LF</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DiagDph (diagonal dephasing): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_DiagDph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OffDiagDph (off-diagonal dephasing): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_OffDiagDph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recomb (spontaneous recombination): </span><span class="si">{</span><span class="n">SBEs</span><span class="o">.</span><span class="n">_Recomb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example: Disable excitons to see Hartree-Fock only</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">To modify physics flags, edit params/mb.params and reinitialize&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Or set module-level variables directly (e.g., SBEs._Excitons = False)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Current Physics Flags:
Optics (light-matter coupling): True
Excitons (excitonic correlations): True
EHs (carrier-carrier scattering): True
Screened (screened Coulomb): True
Phonon (phonon scattering): True
DCTrans (DC transport): True
LF (longitudinal field): True
DiagDph (diagonal dephasing): True
OffDiagDph (off-diagonal dephasing): True
Recomb (spontaneous recombination): True

To modify physics flags, edit params/mb.params and reinitialize
Or set module-level variables directly (e.g., SBEs._Excitons = False)
</pre></div>
</div>
</div>
</div>
</section>
<section id="assumptions-and-parameter-choices">
<h2>Assumptions and Parameter Choices<a class="headerlink" href="#assumptions-and-parameter-choices" title="Link to this heading">¶</a></h2>
<p>This section explains the assumptions and rationale behind the parameter values chosen for this example.</p>
<section id="material-parameters-gaas">
<h3>Material Parameters (GaAs)<a class="headerlink" href="#material-parameters-gaas" title="Link to this heading">¶</a></h3>
<p><strong>Effective masses:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">me_rel</span> <span class="pre">=</span> <span class="pre">0.067</span></code>: Electron effective mass for GaAs (bulk value)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mh_rel</span> <span class="pre">=</span> <span class="pre">0.45</span></code>: Heavy hole effective mass for GaAs (bulk value)</p></li>
<li><p><strong>Rationale</strong>: Standard GaAs bulk values. Quantum confinement may modify these, but bulk values are reasonable for demonstration.</p></li>
</ul>
<p><strong>Band gap:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gap_eV</span> <span class="pre">=</span> <span class="pre">1.5</span></code>: Band gap energy (1.5 eV)</p></li>
<li><p><strong>Rationale</strong>: Representative value for GaAs quantum wires. Actual value depends on confinement.</p></li>
</ul>
<p><strong>Dephasing rates:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gam_e</span> <span class="pre">=</span> <span class="pre">gam_h</span> <span class="pre">=</span> <span class="pre">gam_eh</span> <span class="pre">=</span> <span class="pre">1e12</span> <span class="pre">Hz</span></code>: Constant dephasing rates</p></li>
<li><p><strong>Rationale</strong>: Simplified constant rates. In reality, these depend on temperature, carrier density, and momentum.</p></li>
</ul>
<p><strong>Dielectric constant:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epsr</span> <span class="pre">=</span> <span class="pre">12.0</span></code>: Relative permittivity</p></li>
<li><p><strong>Rationale</strong>: GaAs value at optical frequencies.</p></li>
</ul>
</section>
<section id="wire-dimensions">
<h3>Wire Dimensions<a class="headerlink" href="#wire-dimensions" title="Link to this heading">¶</a></h3>
<p><strong>Wire length:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">L</span> <span class="pre">=</span> <span class="pre">200e-9</span> <span class="pre">m</span></code>: 200 nm wire length</p></li>
<li><p><strong>Rationale</strong>: Representative of quantum wire dimensions. Long enough to show confinement effects.</p></li>
</ul>
<p><strong>Wire thickness:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Delta0</span> <span class="pre">=</span> <span class="pre">5e-9</span> <span class="pre">m</span></code>: 5 nm wire thickness</p></li>
<li><p><strong>Rationale</strong>: Typical quantum wire cross-section dimension.</p></li>
</ul>
</section>
<section id="grid-parameters">
<h3>Grid Parameters<a class="headerlink" href="#grid-parameters" title="Link to this heading">¶</a></h3>
<p><strong>Momentum grid:</strong></p>
<ul class="simple">
<li><p>Automatically calculated by <code class="docutils literal notranslate"><span class="pre">InitializeSBE</span></code> based on energy cutoff</p></li>
<li><p><strong>Rationale</strong>: Grid is determined by maximum momentum needed to represent carriers up to ~1.2× band gap energy.</p></li>
</ul>
<p><strong>Spatial grid:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Nr</span> <span class="pre">=</span> <span class="pre">2</span> <span class="pre">×</span> <span class="pre">Nk</span></code>: Number of spatial points</p></li>
<li><p><strong>Rationale</strong>: FFT convention requires twice the number of k-points for proper sampling.</p></li>
</ul>
</section>
<section id="simplifications">
<h3>Simplifications<a class="headerlink" href="#simplifications" title="Link to this heading">¶</a></h3>
<p><strong>Initial distribution:</strong></p>
<ul class="simple">
<li><p>Fermi-Dirac distribution at energy E = gap/2</p></li>
<li><p><strong>Rationale</strong>: Represents equilibrium distribution. Realistic photoexcitation would start from different initial conditions.</p></li>
</ul>
<p><strong>Static fields:</strong></p>
<ul class="simple">
<li><p>Electric fields are simplified in examples</p></li>
<li><p><strong>Reality</strong>: In full simulations, fields evolve self-consistently with polarization via Maxwell’s equations.</p></li>
</ul>
<p><strong>No phonon scattering:</strong></p>
<ul class="simple">
<li><p>Phonon flag set to 0 in this example</p></li>
<li><p><strong>Reality</strong>: Phonon scattering is important for temperature-dependent dynamics and energy relaxation.</p></li>
</ul>
<p><strong>No DC transport:</strong></p>
<ul class="simple">
<li><p>DC transport flag set to 0</p></li>
<li><p><strong>Reality</strong>: DC fields cause carrier drift and affect transport properties.</p></li>
</ul>
</section>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Important Limitations:</strong></p>
<ol class="arabic simple">
<li><p><strong>Simplified fields</strong>: Electric fields in examples are simplified. Full simulations require self-consistent coupling with Maxwell propagation.</p></li>
<li><p><strong>Limited time steps</strong>: Examples show only a few time steps. Realistic simulations require thousands of steps.</p></li>
<li><p><strong>No phonon effects</strong>: Phonon scattering disabled in this example. Enable for temperature-dependent effects.</p></li>
<li><p><strong>No DC transport</strong>: DC field transport disabled. Enable for drift and diffusion effects.</p></li>
<li><p><strong>Single wire</strong>: Example shows single wire. Multi-wire systems require additional considerations.</p></li>
<li><p><strong>Parameter files</strong>: Examples require parameter files (qw.params, mb.params). In production, these should be managed carefully.</p></li>
</ol>
</div>
</section>
<section id="when-to-use-more-realistic-approaches">
<h3>When to Use More Realistic Approaches<a class="headerlink" href="#when-to-use-more-realistic-approaches" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Full propagation</strong>: When studying pulse propagation, use <code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code> integrated with Maxwell solver</p></li>
<li><p><strong>Phonon scattering</strong>: For temperature-dependent effects, enable phonon flag and include <code class="docutils literal notranslate"><span class="pre">phonons</span></code> module</p></li>
<li><p><strong>DC transport</strong>: For carrier transport studies, enable DC transport flag</p></li>
<li><p><strong>Longitudinal field</strong>: For plasmon effects, enable longitudinal field flag</p></li>
<li><p><strong>Spontaneous emission</strong>: For photoluminescence, enable recombination flag</p></li>
</ul>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>This tutorial demonstrated the <strong>central unifying role</strong> of the <code class="docutils literal notranslate"><span class="pre">SBEs</span></code> module and how it integrates all PSTD3D submodules:</p>
<section id="core-sbes-functions">
<h3>Core SBEs Functions<a class="headerlink" href="#core-sbes-functions" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Initialization</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">InitializeSBE</span></code>: Orchestrates initialization of all integrated modules</p></li>
<li><p>Requires parameter files (qw.params, mb.params)</p></li>
<li><p>Initializes coherence matrices with Fermi-Dirac distributions</p></li>
<li><p><strong>Internally calls</strong>: <code class="docutils literal notranslate"><span class="pre">InitializeQWOptics</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeCoulomb</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeDephasing</span></code>, and conditionally <code class="docutils literal notranslate"><span class="pre">InitializePhonons</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeDC</span></code>, <code class="docutils literal notranslate"><span class="pre">InitializeEmission</span></code></p></li>
</ul>
</li>
<li><p><strong>Time Evolution</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SBECalculator</span></code>: Main solver for one time step</p></li>
<li><p>Uses leapfrog scheme with reshuffling for stability</p></li>
<li><p><strong>Integrates</strong>: Coulomb interactions, dephasing rates, phonon scattering, DC transport, emission</p></li>
</ul>
</li>
<li><p><strong>Preparation</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Preparation</span></code>: Calculates Hamiltonians, screening, and dephasing arrays</p></li>
<li><p><strong>Uses</strong>: Coulomb module (screened interactions), dephasing module (rates), phonons module (scattering)</p></li>
</ul>
</li>
<li><p><strong>Time Derivatives</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dpdt</span></code>: Time derivative of electron-hole coherence</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dCdt</span></code>: Time derivative of electron-electron coherence</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dDdt</span></code>: Time derivative of hole-hole coherence</p></li>
</ul>
</li>
<li><p><strong>Integration</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QWCalculator</span></code>: Main entry point that <strong>unifies all modules</strong> for propagation integration</p></li>
<li><p><strong>Orchestrates</strong>: <code class="docutils literal notranslate"><span class="pre">Prop2QW</span></code> (qwoptics) → <code class="docutils literal notranslate"><span class="pre">SBECalculator</span></code> (SBEs + all modules) → <code class="docutils literal notranslate"><span class="pre">QWPolarization3</span></code>/<code class="docutils literal notranslate"><span class="pre">QWRho5</span></code> (qwoptics) → <code class="docutils literal notranslate"><span class="pre">QW2Prop</span></code> (qwoptics)</p></li>
<li><p>Returns polarization and charge density for Maxwell solver</p></li>
</ul>
</li>
</ol>
</section>
<section id="integrated-modules">
<h3>Integrated Modules<a class="headerlink" href="#integrated-modules" title="Link to this heading">¶</a></h3>
<p>The SBEs module <strong>unifies</strong> the following modules:</p>
<ul class="simple">
<li><p><strong>qwoptics</strong>: Field projection, polarization and charge density calculations</p></li>
<li><p><strong>coulomb</strong>: Screened Coulomb interactions, excitonic correlations</p></li>
<li><p><strong>dephasing</strong>: Momentum-dependent dephasing rates, scattering</p></li>
<li><p><strong>phonons</strong>: Carrier-phonon scattering (conditional on flag)</p></li>
<li><p><strong>dcfield</strong>: DC transport, drift and diffusion (conditional on flag)</p></li>
<li><p><strong>emission</strong>: Spontaneous recombination, photoluminescence (conditional on flag)</p></li>
</ul>
</section>
<section id="key-takeaway">
<h3>Key Takeaway<a class="headerlink" href="#key-takeaway" title="Link to this heading">¶</a></h3>
<p><strong>The SBEs module is the central orchestrator</strong> that brings together all PSTD3D submodules into a cohesive simulation framework. Understanding SBEs is essential for understanding how the entire system works together to solve the complete many-body semiconductor problem. This documentation file is the <strong>most important</strong> in the PSTD3D package because it shows how all the pieces fit together.</p>
</section>
</section>
<section id="complete-unified-example">
<h2>Complete Unified Example<a class="headerlink" href="#complete-unified-example" title="Link to this heading">¶</a></h2>
<p>This final example demonstrates a complete simulation workflow that <strong>unifies all modules</strong> working together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complete unified example showing all modules working together</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Complete Unified Simulation Workflow ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Step 1: Initialize all modules via InitializeSBE</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 1: InitializeSBE orchestrates initialization of:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ QW Optics module (field projection, polarization)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Coulomb module (screened interactions, excitons)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Dephasing module (momentum-dependent rates)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Phonon</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Phonons module (carrier-phonon scattering)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DCTrans</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ DC Field module (transport effects)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Recomb</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Emission module (spontaneous recombination)&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Create time-varying field</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 2: Create time-varying optical field&quot;</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-15</span>  <span class="c1"># 1 fs time step</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">lam</span>

<span class="c1"># Step 3: Time evolution loop (simplified - showing one step)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 3: QWCalculator unifies all modules in time evolution&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → Prop2QW (qwoptics): Propagation → QW field projection&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → SBECalculator (SBEs):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    → Uses Coulomb interactions (coulomb module)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    → Uses dephasing rates (dephasing module)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Phonon</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    → Uses phonon scattering (phonons module)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DCTrans</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    → Uses DC transport (dcfield module)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Recomb</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    → Uses spontaneous emission (emission module)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → QWPolarization3 &amp; QWRho5 (qwoptics): Calculate outputs&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  → QW2Prop (qwoptics): QW → Propagation field projection&quot;</span><span class="p">)</span>

<span class="c1"># Create fields for one time step</span>
<span class="n">Exx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">R_prop</span> <span class="o">-</span> <span class="n">r0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">50e-9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1e6</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span><span class="p">)</span>
<span class="n">Eyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx</span><span class="p">)</span>
<span class="n">Ezz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx</span><span class="p">)</span>
<span class="n">Vrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">Exx</span><span class="p">)</span>

<span class="c1"># Output arrays</span>
<span class="n">Pxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Pzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">Rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">R_prop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">DoQWP</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
<span class="n">DoQWDl</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

<span class="c1"># Call QWCalculator - this unifies everything!</span>
<span class="n">QWCalculator</span><span class="p">(</span><span class="n">Exx</span><span class="p">,</span> <span class="n">Eyy</span><span class="p">,</span> <span class="n">Ezz</span><span class="p">,</span> <span class="n">Vrr</span><span class="p">,</span> <span class="n">R_prop</span><span class="p">,</span> <span class="n">q_prop</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Pxx</span><span class="p">,</span> <span class="n">Pyy</span><span class="p">,</span> <span class="n">Pzz</span><span class="p">,</span> <span class="n">Rho</span><span class="p">,</span> <span class="n">DoQWP</span><span class="p">,</span> <span class="n">DoQWDl</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 4: Results available in propagation space&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ Polarization: max |P| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Pxx</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ Charge density: max |ρ| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Rho</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m⁻³&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ Use polarization: </span><span class="si">{</span><span class="n">DoQWP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ Use longitudinal field: </span><span class="si">{</span><span class="n">DoQWDl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Visualize complete workflow results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Input field</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Exx</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|E| (V/m)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input: Propagation Space Field&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wire&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Output polarization</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Pxx</span><span class="p">),</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization (C/m²)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output: Polarization (All Modules Unified)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Charge density</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_prop</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Rho</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Position (nm)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Charge Density (m⁻³)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output: Charge Density (All Modules Unified)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Module status</span>
<span class="n">module_status</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QW Optics: ✓&quot;</span><span class="p">)</span>
<span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coulomb: ✓&quot;</span><span class="p">)</span>
<span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dephasing: ✓&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Phonon</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phonons: ✓&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phonons: (disabled)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_DCTrans</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DC Field: ✓&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DC Field: (disabled)&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">SBEs</span><span class="o">.</span><span class="n">_Recomb</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emission: ✓&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">module_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emission: (disabled)&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">module_status</span><span class="p">),</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;monospace&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Active Modules&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Summary: SBEs Unifies All Modules ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The SBEs module successfully orchestrates:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Field projection (qwoptics)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Many-body interactions (coulomb)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Scattering effects (dephasing, phonons)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Transport (dcfield)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Emission (emission)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  • Complete time evolution (SBEs)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This unified framework enables realistic simulations of&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ultrafast carrier dynamics in quantum wire systems!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Complete Unified Simulation Workflow ===

Step 1: InitializeSBE orchestrates initialization of:
  ✓ QW Optics module (field projection, polarization)
  ✓ Coulomb module (screened interactions, excitons)
  ✓ Dephasing module (momentum-dependent rates)
  ✓ Phonons module (carrier-phonon scattering)
  ✓ DC Field module (transport effects)
  ✓ Emission module (spontaneous recombination)

Step 2: Create time-varying optical field

Step 3: QWCalculator unifies all modules in time evolution
  → Prop2QW (qwoptics): Propagation → QW field projection
  → SBECalculator (SBEs):
    → Uses Coulomb interactions (coulomb module)
    → Uses dephasing rates (dephasing module)
    → Uses phonon scattering (phonons module)
    → Uses DC transport (dcfield module)
    → Uses spontaneous emission (emission module)
  → QWPolarization3 &amp; QWRho5 (qwoptics): Calculate outputs
  → QW2Prop (qwoptics): QW → Propagation field projection
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">52</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> <span class="n">DoQWDl</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="c1"># Call QWCalculator - this unifies everything!</span>
<span class="ne">---&gt; </span><span class="mi">52</span> <span class="n">QWCalculator</span><span class="p">(</span><span class="n">Exx</span><span class="p">,</span> <span class="n">Eyy</span><span class="p">,</span> <span class="n">Ezz</span><span class="p">,</span> <span class="n">Vrr</span><span class="p">,</span> <span class="n">R_prop</span><span class="p">,</span> <span class="n">q_prop</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Pxx</span><span class="p">,</span> <span class="n">Pyy</span><span class="p">,</span> <span class="n">Pzz</span><span class="p">,</span> <span class="n">Rho</span><span class="p">,</span> <span class="n">DoQWP</span><span class="p">,</span> <span class="n">DoQWDl</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step 4: Results available in propagation space&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ Polarization: max |P| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Pxx</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> C/m²&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;QWCalculator&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../gallery.html" class="btn btn-neutral float-left" title="Examples Gallery" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="coulomb_example.myst.html" class="btn btn-neutral float-right" title="Coulomb Interactions in Quantum Wires" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Rahul R. Sah and PulseSuite Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>